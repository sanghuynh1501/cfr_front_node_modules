{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/row/style\";\nimport _Row from \"antd/es/row\";\nimport \"antd/es/col/style\";\nimport _Col from \"antd/es/col\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport \"antd/es/icon/style\";\nimport _Icon from \"antd/es/icon\";\nimport _regeneratorRuntime from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/conference2/modals/StreamKeyDialog.jsx\";\nimport React from 'react';\nimport { newNotification } from '@utils';\nimport { inject } from 'mobx-react';\nimport client, { M_START_STREAM } from '@graphql';\n\nfunction hasErrors(fieldsError) {\n  return Object.keys(fieldsError).some(function (field) {\n    return fieldsError[field];\n  });\n}\n\nvar StreamKeyDialog = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(StreamKeyDialog, _React$PureComponent);\n\n  var _super = _createSuper(StreamKeyDialog);\n\n  function StreamKeyDialog() {\n    var _this;\n\n    _classCallCheck(this, StreamKeyDialog);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      visible: false,\n      broadcasts: undefined,\n      errorType: undefined,\n      selectedBoundStreamID: undefined,\n      loading: false\n    };\n\n    _this.showModal = function () {\n      _this.setState({\n        visible: true\n      });\n    };\n\n    _this.handleCancel = function () {\n      _this.setState({\n        visible: false\n      });\n    };\n\n    _this.handleSubmit = function (e) {\n      e.preventDefault();\n\n      _this.props.form.validateFields( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(err, values) {\n          var keyYoutube;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (err) {\n                    _context.next = 5;\n                    break;\n                  }\n\n                  _this.setState({\n                    loading: true\n                  });\n\n                  keyYoutube = values.streamKey;\n                  _context.next = 5;\n                  return client.mutate({\n                    mutation: M_START_STREAM,\n                    variables: {\n                      conferenceId: _this.props.stores.conferenceState.conference._id,\n                      keyYoutube: keyYoutube\n                    }\n                  }).then(function (res) {\n                    var _res$data;\n\n                    if (res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.startStream) {\n                      _this.setState({\n                        loading: false,\n                        visible: false\n                      });\n\n                      return newNotification('Đang bắt đầu phát trực tuyến!', 'success');\n                    }\n\n                    throw new Error('Có lỗi xảy ra!');\n                  }).catch(function (err) {\n                    _this.setState({\n                      loading: false\n                    });\n\n                    return newNotification(err.message, 'danger');\n                  });\n\n                case 5:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x, _x2) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    };\n\n    return _this;\n  }\n\n  _createClass(StreamKeyDialog, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.handleOpen(this.showModal);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props$form = this.props.form,\n          getFieldDecorator = _this$props$form.getFieldDecorator,\n          getFieldsError = _this$props$form.getFieldsError;\n      return /*#__PURE__*/React.createElement(_Modal, {\n        title: \"Start Live Stream\",\n        visible: this.state.visible,\n        closable: false,\n        centered: true,\n        footer: null,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(_Form, {\n        layout: \"horizontal\",\n        onSubmit: this.handleSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(_Form.Item, {\n        label: \"Live stream key\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 11\n        }\n      }, getFieldDecorator('streamKey', {\n        initialValue: '',\n        rules: [{\n          required: true,\n          message: 'Please enter your Youtube live stream key to start!'\n        }, {\n          pattern: /^([a-z0-9]{4}-){3}([a-z0-9]{4})$/,\n          message: 'Your stream key not invalid!'\n        }]\n      })( /*#__PURE__*/React.createElement(_Input, {\n        prefix: /*#__PURE__*/React.createElement(_Icon, {\n          type: \"key\",\n          style: {\n            color: 'rgba(0,0,0,.25)'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 25\n          }\n        }),\n        placeholder: \"Enter your Youtube live stream key here.\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 15\n        }\n      }))), /*#__PURE__*/React.createElement(_Form.Item, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(_Row, {\n        type: \"flex\",\n        justify: \"end\",\n        gutter: 20,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(_Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(_Button, {\n        type: \"primary\",\n        htmlType: \"submit\",\n        disabled: hasErrors(getFieldsError()),\n        loading: this.state.loading,\n        onClick: this.handleSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 17\n        }\n      }, \"Start live stream\")), /*#__PURE__*/React.createElement(_Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(_Button, {\n        type: \"link\",\n        onClick: this.handleCancel,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 17\n        }\n      }, \"Cancel\"))))));\n    }\n  }]);\n\n  return StreamKeyDialog;\n}(React.PureComponent);\n\nexport default inject('stores')(_Form.create()(StreamKeyDialog));","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/conference2/modals/StreamKeyDialog.jsx"],"names":["React","newNotification","inject","client","M_START_STREAM","hasErrors","fieldsError","Object","keys","some","field","StreamKeyDialog","state","visible","broadcasts","undefined","errorType","selectedBoundStreamID","loading","showModal","setState","handleCancel","handleSubmit","e","preventDefault","props","form","validateFields","err","values","keyYoutube","streamKey","mutate","mutation","variables","conferenceId","stores","conferenceState","conference","_id","then","res","data","startStream","Error","catch","message","handleOpen","getFieldDecorator","getFieldsError","initialValue","rules","required","pattern","color","PureComponent","create"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Modal, Form, Input, Icon, Button, Row, Col } from 'antd'\n\nimport { newNotification } from '@utils'\nimport { inject } from 'mobx-react'\nimport client, { M_START_STREAM } from '@graphql'\n\nfunction hasErrors(fieldsError) {\n  return Object.keys(fieldsError).some(field => fieldsError[field])\n}\n\nclass StreamKeyDialog extends React.PureComponent {\n  state = {\n    visible: false,\n    broadcasts: undefined,\n    errorType: undefined,\n    selectedBoundStreamID: undefined,\n    loading: false\n  }\n\n  componentDidMount() {\n    this.props.handleOpen(this.showModal)\n  }\n\n  showModal = () => {\n    this.setState({ visible: true })\n  }\n\n  handleCancel = () => {\n    this.setState({ visible: false })\n  }\n\n  handleSubmit = e => {\n    e.preventDefault()\n    this.props.form.validateFields(async (err, values) => {\n      if (!err) {\n        this.setState({ loading: true })\n        const keyYoutube = values.streamKey\n        await client\n          .mutate({\n            mutation: M_START_STREAM,\n            variables: {\n              conferenceId: this.props.stores.conferenceState.conference._id,\n              keyYoutube\n            }\n          })\n          .then(res => {\n            if (res?.data?.startStream) {\n              this.setState({ loading: false, visible: false })\n              return newNotification('Đang bắt đầu phát trực tuyến!', 'success')\n            }\n            throw new Error('Có lỗi xảy ra!')\n          })\n          .catch(err => {\n            this.setState({ loading: false })\n            return newNotification(err.message, 'danger')\n          })\n\n      }\n    })\n  }\n\n  render() {\n    const { getFieldDecorator, getFieldsError } = this.props.form\n    return (\n      <Modal title='Start Live Stream' visible={this.state.visible} closable={false} centered footer={null}>\n        <Form layout='horizontal' onSubmit={this.handleSubmit}>\n          <Form.Item label='Live stream key'>\n            {getFieldDecorator('streamKey', {\n              initialValue: '',\n              rules: [\n                {\n                  required: true,\n                  message: 'Please enter your Youtube live stream key to start!'\n                },\n                {\n                  pattern: /^([a-z0-9]{4}-){3}([a-z0-9]{4})$/,\n                  message: 'Your stream key not invalid!'\n                }\n              ]\n            })(\n              <Input\n                prefix={<Icon type='key' style={{ color: 'rgba(0,0,0,.25)' }} />}\n                placeholder='Enter your Youtube live stream key here.'\n              />\n            )}\n          </Form.Item>\n          <Form.Item>\n            <Row type='flex' justify='end' gutter={20}>\n              <Col>\n                <Button\n                  type='primary'\n                  htmlType='submit'\n                  disabled={hasErrors(getFieldsError())}\n                  loading={this.state.loading}\n                  onClick={this.handleSubmit}\n                >\n                  Start live stream\n                </Button>\n              </Col>\n              <Col>\n                <Button type='link' onClick={this.handleCancel}>\n                  Cancel\n                </Button>\n              </Col>\n            </Row>\n          </Form.Item>\n        </Form>\n      </Modal>\n    )\n  }\n}\n\nexport default inject('stores')(Form.create()(StreamKeyDialog))"]},"metadata":{},"sourceType":"module"}