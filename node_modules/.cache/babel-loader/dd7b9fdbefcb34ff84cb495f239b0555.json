{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/upload/style\";\nimport _Upload from \"antd/es/upload\";\nimport \"antd/es/avatar/style\";\nimport _Avatar from \"antd/es/avatar\";\nimport \"antd/es/icon/style\";\nimport _Icon from \"antd/es/icon\";\nimport _regeneratorRuntime from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/dashboard/profile/ModalChangeAvatar.jsx\";\nimport React, { Component } from 'react';\nimport { withTranslation } from 'react-i18next';\nimport http from 'http';\nimport https from 'https';\nimport { returnError, newNotification, parseError } from '@utils';\nimport { client, M_UPDATE_AVATAR } from '@graphql';\n\nvar ModalChangeAvatar = /*#__PURE__*/function (_Component) {\n  _inherits(ModalChangeAvatar, _Component);\n\n  var _super = _createSuper(ModalChangeAvatar);\n\n  function ModalChangeAvatar() {\n    var _this;\n\n    _classCallCheck(this, ModalChangeAvatar);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      imageURL: null\n    };\n    return _this;\n  }\n\n  _createClass(ModalChangeAvatar, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          handleClose = _this$props.handleClose,\n          visible = _this$props.visible,\n          queryMyInfo = _this$props.queryMyInfo,\n          imageUrl = _this$props.imageUrl,\n          i18n = _this$props.i18n;\n\n      var readFileImg = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(info) {\n          var _info$file, status, response;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _info$file = info.file, status = _info$file.status, response = _info$file.response;\n\n                  if (status === 'uploading') {} else {\n                    if (process.env.NODE_ENV === 'production') {\n                      _this2.setState({\n                        imageURL: \"\".concat(window.location.origin, \"/images/cfr/\").concat(response) || null\n                      });\n                    } else {\n                      _this2.setState({\n                        imageURL: \"http://\".concat(process.env.REACT_APP_GRAPHQL_URN.split('/').shift(), \"/images/\").concat(response) || null\n                      });\n                    }\n                  }\n\n                case 2:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function readFileImg(_x) {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      var removeImageSelected = function removeImageSelected() {\n        if (_this2.state.imageURL) {\n          var idFile = _this2.state.imageURL.split('/').pop();\n\n          if (process.env.NODE_ENV === 'production') {\n            https.get(\"\".concat(window.location.origin, \"/uploadcfr/upload-file/remove/\").concat(idFile), function (resp) {\n              var data = false;\n              resp.on('data', function (chunk) {\n                data = chunk;\n              });\n              resp.on('end', function () {\n                console.log(data);\n              });\n            }).on('error', function (err) {\n              console.error('Remove file: ', err);\n            });\n          } else if (process.env.NODE_ENV === 'development') {\n            http.get(\"http://\".concat(process.env.REACT_APP_GRAPHQL_URN.split('/').shift(), \"/upload-file/remove/\").concat(idFile), function (resp) {\n              var data = false;\n              resp.on('data', function (chunk) {\n                data = chunk;\n              });\n              resp.on('end', function () {\n                console.log(data);\n              });\n            }).on('error', function (err) {\n              console.error('Remove file: ', err);\n            });\n          } else {\n            newNotification(\"Env \".concat(process.env.REACT_APP_GRAPHQL_URN, \" is not provide!\"), 'danger', {\n              container: 'top-right'\n            });\n            return;\n          }\n\n          _this2.setState({\n            imageURL: null\n          });\n        }\n      };\n\n      var onOk = function onOk() {\n        if (_this2.state.imageURL === null) {\n          queryMyInfo();\n          handleClose();\n        } else {\n          client.mutate({\n            mutation: M_UPDATE_AVATAR,\n            variables: {\n              userId: _this2.props._id,\n              imageUrl: _this2.state.imageURL\n            }\n          }).then(function (e) {\n            queryMyInfo();\n            handleClose();\n            newNotification(i18n.t('notification.updateAvatarSuccess'), 'success', {\n              container: 'top-right'\n            });\n          }).catch(function (errors) {\n            returnError('Error', {\n              errorMessage: _this2.props.i18n.t(parseError(errors))\n            }, {\n              container: 'top-right'\n            });\n          });\n        }\n      };\n\n      var onCancel = function onCancel() {\n        _this2.setState({\n          imageURL: null\n        }, function () {\n          handleClose();\n          removeImageSelected();\n        });\n      };\n\n      return /*#__PURE__*/React.createElement(_Modal, {\n        className: \"common-modal\",\n        title: i18n.t('user.changePicture'),\n        onCancel: onCancel,\n        onOk: onOk,\n        visible: visible,\n        centered: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 9\n        }\n      }, i18n.t('user.prevTitleUpload'), /*#__PURE__*/React.createElement(\"span\", {\n        style: {\n          color: 'red'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 11\n        }\n      }, \" 2M \"), i18n.t('user.nextTitleUpload')), /*#__PURE__*/React.createElement(_Upload, {\n        name: \"rawImage\",\n        type: \"file\",\n        accept: \"image/*\",\n        listType: \"picture-card\",\n        className: \"avatarUpload\",\n        action: process.env.NODE_ENV === 'development' ? \"http://\".concat(process.env.REACT_APP_GRAPHQL_URN.split('/').shift(), \"/upload-file/image\") : \"\".concat(window.location.origin, \"/uploadcfr/upload-file/image\"),\n        showUploadList: false,\n        onChange: readFileImg,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"upload-btn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        onClick: function onClick(e) {\n          _this2.setState({\n            imageURL: null\n          }, function () {\n            removeImageSelected();\n          });\n\n          e.stopPropagation();\n        },\n        style: {\n          display: this.state.imageURL ? 'block' : 'none'\n        },\n        className: \"closeBtnHolder\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(_Icon, {\n        type: \"close\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 15\n        }\n      })), this.state.imageURL || imageUrl ? /*#__PURE__*/React.createElement(_Avatar, {\n        style: {\n          backgroundColor: '#CCCCCC',\n          verticalAlign: 'middle',\n          height: '300px',\n          width: '300px'\n        },\n        src: this.state.imageURL || imageUrl,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 15\n        }\n      }) : /*#__PURE__*/React.createElement(\"div\", {\n        className: \"whenNoFile\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(_Icon, {\n        type: \"plus\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 21\n        }\n      }, \"add something\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"wrapper-button\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(_Button, {\n        type: \"primary\",\n        onClick: onOk,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 11\n        }\n      }, i18n.t('common.save')), /*#__PURE__*/React.createElement(_Button, {\n        type: \"primary\",\n        ghost: true,\n        onClick: onCancel,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 11\n        }\n      }, i18n.t('common.cancel'))));\n    }\n  }]);\n\n  return ModalChangeAvatar;\n}(Component);\n\nexport default withTranslation()(ModalChangeAvatar);","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/dashboard/profile/ModalChangeAvatar.jsx"],"names":["React","Component","withTranslation","http","https","returnError","newNotification","parseError","client","M_UPDATE_AVATAR","ModalChangeAvatar","state","imageURL","props","handleClose","visible","queryMyInfo","imageUrl","i18n","readFileImg","info","file","status","response","process","env","NODE_ENV","setState","window","location","origin","REACT_APP_GRAPHQL_URN","split","shift","removeImageSelected","idFile","pop","get","resp","data","on","chunk","console","log","err","error","container","onOk","mutate","mutation","variables","userId","_id","then","e","t","catch","errors","errorMessage","onCancel","color","stopPropagation","display","backgroundColor","verticalAlign","height","width"],"mappings":";;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AAEA,SAASC,eAAT,QAAgC,eAAhC;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,SAASC,WAAT,EAAsBC,eAAtB,EAAuCC,UAAvC,QAAyD,QAAzD;AACA,SAASC,MAAT,EAAiBC,eAAjB,QAAwC,UAAxC;;IAEMC,iB;;;;;;;;;;;;;;;UACJC,K,GAAQ;AACNC,MAAAA,QAAQ,EAAE;AADJ,K;;;;;;6BAIC;AAAA;;AAAA,wBAGH,IAHG,CAELC,KAFK;AAAA,UAEIC,WAFJ,eAEIA,WAFJ;AAAA,UAEiBC,OAFjB,eAEiBA,OAFjB;AAAA,UAE0BC,WAF1B,eAE0BA,WAF1B;AAAA,UAEuCC,QAFvC,eAEuCA,QAFvC;AAAA,UAEiDC,IAFjD,eAEiDA,IAFjD;;AAKP,UAAMC,WAAW;AAAA,4EAAG,iBAAMC,IAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,+BAGdA,IAHc,CAEhBC,IAFgB,EAERC,MAFQ,cAERA,MAFQ,EAEAC,QAFA,cAEAA,QAFA;;AAIlB,sBAAID,MAAM,KAAK,WAAf,EAA4B,CAC3B,CADD,MACO;AACL,wBAAIE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AACzC,sBAAA,MAAI,CAACC,QAAL,CAAc;AACZf,wBAAAA,QAAQ,EAAE,UAAGgB,MAAM,CAACC,QAAP,CAAgBC,MAAnB,yBAAwCP,QAAxC,KAAsD;AADpD,uBAAd;AAGD,qBAJD,MAIO;AACL,sBAAA,MAAI,CAACI,QAAL,CAAc;AACZf,wBAAAA,QAAQ,EACN,iBAAUY,OAAO,CAACC,GAAR,CAAYM,qBAAZ,CAAkCC,KAAlC,CACR,GADQ,EAERC,KAFQ,EAAV,qBAEoBV,QAFpB,KAEkC;AAJxB,uBAAd;AAMD;AACF;;AAlBiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAH;;AAAA,wBAAXJ,WAAW;AAAA;AAAA;AAAA,SAAjB;;AAqBA,UAAMe,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;AAChC,YAAI,MAAI,CAACvB,KAAL,CAAWC,QAAf,EAAyB;AACvB,cAAMuB,MAAM,GAAG,MAAI,CAACxB,KAAL,CAAWC,QAAX,CAAoBoB,KAApB,CAA0B,GAA1B,EAA+BI,GAA/B,EAAf;;AACA,cAAIZ,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AACzCtB,YAAAA,KAAK,CACFiC,GADH,WAEOT,MAAM,CAACC,QAAP,CAAgBC,MAFvB,2CAE8DK,MAF9D,GAGI,UAAAG,IAAI,EAAI;AACN,kBAAIC,IAAI,GAAG,KAAX;AACAD,cAAAA,IAAI,CAACE,EAAL,CAAQ,MAAR,EAAgB,UAAAC,KAAK,EAAI;AACvBF,gBAAAA,IAAI,GAAGE,KAAP;AACD,eAFD;AAGAH,cAAAA,IAAI,CAACE,EAAL,CAAQ,KAAR,EAAe,YAAM;AACnBE,gBAAAA,OAAO,CAACC,GAAR,CAAYJ,IAAZ;AACD,eAFD;AAGD,aAXL,EAaGC,EAbH,CAaM,OAbN,EAae,UAAAI,GAAG,EAAI;AAClBF,cAAAA,OAAO,CAACG,KAAR,CAAc,eAAd,EAA+BD,GAA/B;AACD,aAfH;AAgBD,WAjBD,MAiBO,IAAIpB,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;AACjDvB,YAAAA,IAAI,CACDkC,GADH,kBAEcb,OAAO,CAACC,GAAR,CAAYM,qBAAZ,CAAkCC,KAAlC,CACR,GADQ,EAERC,KAFQ,EAFd,iCAIoCE,MAJpC,GAKI,UAAAG,IAAI,EAAI;AACN,kBAAIC,IAAI,GAAG,KAAX;AACAD,cAAAA,IAAI,CAACE,EAAL,CAAQ,MAAR,EAAgB,UAAAC,KAAK,EAAI;AACvBF,gBAAAA,IAAI,GAAGE,KAAP;AACD,eAFD;AAGAH,cAAAA,IAAI,CAACE,EAAL,CAAQ,KAAR,EAAe,YAAM;AACnBE,gBAAAA,OAAO,CAACC,GAAR,CAAYJ,IAAZ;AACD,eAFD;AAGD,aAbL,EAeGC,EAfH,CAeM,OAfN,EAee,UAAAI,GAAG,EAAI;AAClBF,cAAAA,OAAO,CAACG,KAAR,CAAc,eAAd,EAA+BD,GAA/B;AACD,aAjBH;AAkBD,WAnBM,MAmBA;AACLtC,YAAAA,eAAe,eACNkB,OAAO,CAACC,GAAR,CAAYM,qBADN,uBAEb,QAFa,EAGb;AACEe,cAAAA,SAAS,EAAE;AADb,aAHa,CAAf;AAOA;AACD;;AACD,UAAA,MAAI,CAACnB,QAAL,CAAc;AAAEf,YAAAA,QAAQ,EAAE;AAAZ,WAAd;AACD;AACF,OAnDD;;AAqDA,UAAMmC,IAAI,GAAG,SAAPA,IAAO,GAAM;AACjB,YAAI,MAAI,CAACpC,KAAL,CAAWC,QAAX,KAAwB,IAA5B,EAAkC;AAChCI,UAAAA,WAAW;AACXF,UAAAA,WAAW;AACZ,SAHD,MAGO;AACLN,UAAAA,MAAM,CACHwC,MADH,CACU;AACNC,YAAAA,QAAQ,EAAExC,eADJ;AAENyC,YAAAA,SAAS,EAAE;AACTC,cAAAA,MAAM,EAAE,MAAI,CAACtC,KAAL,CAAWuC,GADV;AAETnC,cAAAA,QAAQ,EAAE,MAAI,CAACN,KAAL,CAAWC;AAFZ;AAFL,WADV,EAQGyC,IARH,CAQQ,UAAAC,CAAC,EAAI;AACTtC,YAAAA,WAAW;AACXF,YAAAA,WAAW;AACXR,YAAAA,eAAe,CAACY,IAAI,CAACqC,CAAL,CAAO,kCAAP,CAAD,EAA6C,SAA7C,EAAwD;AACrET,cAAAA,SAAS,EAAE;AAD0D,aAAxD,CAAf;AAGD,WAdH,EAeGU,KAfH,CAeS,UAAAC,MAAM,EAAI;AACfpD,YAAAA,WAAW,CACT,OADS,EAET;AAAEqD,cAAAA,YAAY,EAAE,MAAI,CAAC7C,KAAL,CAAWK,IAAX,CAAgBqC,CAAhB,CAAkBhD,UAAU,CAACkD,MAAD,CAA5B;AAAhB,aAFS,EAGT;AAAEX,cAAAA,SAAS,EAAE;AAAb,aAHS,CAAX;AAKD,WArBH;AAsBD;AACF,OA5BD;;AA8BA,UAAMa,QAAQ,GAAG,SAAXA,QAAW,GAAM;AACrB,QAAA,MAAI,CAAChC,QAAL,CAAc;AAAEf,UAAAA,QAAQ,EAAE;AAAZ,SAAd,EAAkC,YAAM;AACtCE,UAAAA,WAAW;AACXoB,UAAAA,mBAAmB;AACpB,SAHD;AAID,OALD;;AAOA,0BACE;AACE,QAAA,SAAS,EAAC,cADZ;AAEE,QAAA,KAAK,EAAEhB,IAAI,CAACqC,CAAL,CAAO,oBAAP,CAFT;AAGE,QAAA,QAAQ,EAAEI,QAHZ;AAIE,QAAA,IAAI,EAAEZ,IAJR;AAKE,QAAA,OAAO,EAAEhC,OALX;AAME,QAAA,QAAQ,MANV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAQE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGG,IAAI,CAACqC,CAAL,CAAO,sBAAP,CADH,eAEE;AAAM,QAAA,KAAK,EAAE;AAAEK,UAAAA,KAAK,EAAE;AAAT,SAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,EAGG1C,IAAI,CAACqC,CAAL,CAAO,sBAAP,CAHH,CARF,eAaE;AACE,QAAA,IAAI,EAAC,UADP;AAEE,QAAA,IAAI,EAAC,MAFP;AAGE,QAAA,MAAM,EAAC,SAHT;AAIE,QAAA,QAAQ,EAAC,cAJX;AAKE,QAAA,SAAS,EAAC,cALZ;AAME,QAAA,MAAM,EACJ/B,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAAzB,oBACcF,OAAO,CAACC,GAAR,CAAYM,qBAAZ,CAAkCC,KAAlC,CACV,GADU,EAEVC,KAFU,EADd,oCAIOL,MAAM,CAACC,QAAP,CAAgBC,MAJvB,iCAPJ;AAaE,QAAA,cAAc,EAAE,KAblB;AAcE,QAAA,QAAQ,EAAEX,WAdZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAgBE;AAAK,QAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,OAAO,EAAE,iBAAAmC,CAAC,EAAI;AACZ,UAAA,MAAI,CAAC3B,QAAL,CAAc;AAAEf,YAAAA,QAAQ,EAAE;AAAZ,WAAd,EAAkC,YAAM;AACtCsB,YAAAA,mBAAmB;AACpB,WAFD;;AAGAoB,UAAAA,CAAC,CAACO,eAAF;AACD,SANH;AAOE,QAAA,KAAK,EAAE;AAAEC,UAAAA,OAAO,EAAE,KAAKnD,KAAL,CAAWC,QAAX,GAAsB,OAAtB,GAAgC;AAA3C,SAPT;AAQE,QAAA,SAAS,EAAC,gBARZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAUE;AAAM,QAAA,IAAI,EAAC,OAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAVF,CADF,EAaG,KAAKD,KAAL,CAAWC,QAAX,IAAuBK,QAAvB,gBACC;AACE,QAAA,KAAK,EAAE;AACL8C,UAAAA,eAAe,EAAE,SADZ;AAELC,UAAAA,aAAa,EAAE,QAFV;AAGLC,UAAAA,MAAM,EAAE,OAHH;AAILC,UAAAA,KAAK,EAAE;AAJF,SADT;AAOE,QAAA,GAAG,EAAE,KAAKvD,KAAL,CAAWC,QAAX,IAAuBK,QAP9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADD,gBAWG;AAAK,QAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAM,QAAA,IAAI,EAAC,MAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAFF,CADF,CAxBN,CAhBF,CAbF,eA8DE;AAAK,QAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAQ,QAAA,IAAI,EAAC,SAAb;AAAuB,QAAA,OAAO,EAAE8B,IAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACG7B,IAAI,CAACqC,CAAL,CAAO,aAAP,CADH,CADF,eAIE;AAAQ,QAAA,IAAI,EAAC,SAAb;AAAuB,QAAA,KAAK,MAA5B;AAA6B,QAAA,OAAO,EAAEI,QAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGzC,IAAI,CAACqC,CAAL,CAAO,eAAP,CADH,CAJF,CA9DF,CADF;AAyED;;;;EAlM6BtD,S;;AAqMhC,eAAeC,eAAe,GAAGQ,iBAAH,CAA9B","sourcesContent":["import React, { Component } from 'react'\nimport { Modal, Upload, Button, Avatar, Icon } from 'antd'\nimport { withTranslation } from 'react-i18next'\nimport http from 'http'\nimport https from 'https'\n\nimport { returnError, newNotification, parseError } from '@utils'\nimport { client, M_UPDATE_AVATAR } from '@graphql'\n\nclass ModalChangeAvatar extends Component {\n  state = {\n    imageURL: null\n  }\n\n  render() {\n    const {\n      props: { handleClose, visible, queryMyInfo, imageUrl, i18n }\n    } = this\n\n    const readFileImg = async info => {\n      const {\n        file: { status, response }\n      } = info\n      if (status === 'uploading') {\n      } else {\n        if (process.env.NODE_ENV === 'production') {\n          this.setState({\n            imageURL: `${window.location.origin}/images/cfr/${response}` || null\n          })\n        } else {\n          this.setState({\n            imageURL:\n              `http://${process.env.REACT_APP_GRAPHQL_URN.split(\n                '/'\n              ).shift()}/images/${response}` || null\n          })\n        }\n      }\n    }\n\n    const removeImageSelected = () => {\n      if (this.state.imageURL) {\n        const idFile = this.state.imageURL.split('/').pop()\n        if (process.env.NODE_ENV === 'production') {\n          https\n            .get(\n              `${window.location.origin}/uploadcfr/upload-file/remove/${idFile}`,\n              resp => {\n                let data = false\n                resp.on('data', chunk => {\n                  data = chunk\n                })\n                resp.on('end', () => {\n                  console.log(data)\n                })\n              }\n            )\n            .on('error', err => {\n              console.error('Remove file: ', err)\n            })\n        } else if (process.env.NODE_ENV === 'development') {\n          http\n            .get(\n              `http://${process.env.REACT_APP_GRAPHQL_URN.split(\n                '/'\n              ).shift()}/upload-file/remove/${idFile}`,\n              resp => {\n                let data = false\n                resp.on('data', chunk => {\n                  data = chunk\n                })\n                resp.on('end', () => {\n                  console.log(data)\n                })\n              }\n            )\n            .on('error', err => {\n              console.error('Remove file: ', err)\n            })\n        } else {\n          newNotification(\n            `Env ${process.env.REACT_APP_GRAPHQL_URN} is not provide!`,\n            'danger',\n            {\n              container: 'top-right'\n            }\n          )\n          return\n        }\n        this.setState({ imageURL: null })\n      }\n    }\n\n    const onOk = () => {\n      if (this.state.imageURL === null) {\n        queryMyInfo()\n        handleClose()\n      } else {\n        client\n          .mutate({\n            mutation: M_UPDATE_AVATAR,\n            variables: {\n              userId: this.props._id,\n              imageUrl: this.state.imageURL\n            }\n          })\n          .then(e => {\n            queryMyInfo()\n            handleClose()\n            newNotification(i18n.t('notification.updateAvatarSuccess'), 'success', {\n              container: 'top-right'\n            })\n          })\n          .catch(errors => {\n            returnError(\n              'Error',\n              { errorMessage: this.props.i18n.t(parseError(errors)) },\n              { container: 'top-right' }\n            )\n          })\n      }\n    }\n\n    const onCancel = () => {\n      this.setState({ imageURL: null }, () => {\n        handleClose()\n        removeImageSelected()\n      })\n    }\n\n    return (\n      <Modal\n        className='common-modal'\n        title={i18n.t('user.changePicture')}\n        onCancel={onCancel}\n        onOk={onOk}\n        visible={visible}\n        centered\n      >\n        <span>\n          {i18n.t('user.prevTitleUpload')}\n          <span style={{ color: 'red' }}> 2M </span>\n          {i18n.t('user.nextTitleUpload')}\n        </span>\n        <Upload\n          name='rawImage'\n          type='file'\n          accept='image/*'\n          listType='picture-card'\n          className='avatarUpload'\n          action={\n            process.env.NODE_ENV === 'development'\n              ? `http://${process.env.REACT_APP_GRAPHQL_URN.split(\n                '/'\n              ).shift()}/upload-file/image`\n              : `${window.location.origin}/uploadcfr/upload-file/image`\n          }\n          showUploadList={false}\n          onChange={readFileImg}\n        >\n          <div className='upload-btn'>\n            <span\n              onClick={e => {\n                this.setState({ imageURL: null }, () => {\n                  removeImageSelected()\n                })\n                e.stopPropagation()\n              }}\n              style={{ display: this.state.imageURL ? 'block' : 'none' }}\n              className='closeBtnHolder'\n            >\n              <Icon type='close' />\n            </span>\n            {this.state.imageURL || imageUrl ? (\n              <Avatar\n                style={{\n                  backgroundColor: '#CCCCCC',\n                  verticalAlign: 'middle',\n                  height: '300px',\n                  width: '300px'\n                }}\n                src={this.state.imageURL || imageUrl}\n              />\n            ) : (\n                <div className='whenNoFile'>\n                  <div>\n                    <Icon type='plus' />\n                    <span>add something</span>\n                  </div>\n                </div>\n              )}\n          </div>\n        </Upload>\n        <div className='wrapper-button'>\n          <Button type='primary' onClick={onOk}>\n            {i18n.t('common.save')}\n          </Button>\n          <Button type='primary' ghost onClick={onCancel}>\n            {i18n.t('common.cancel')}\n          </Button>\n        </div>\n      </Modal>\n    )\n  }\n}\n\nexport default withTranslation()(ModalChangeAvatar)\n"]},"metadata":{},"sourceType":"module"}