{"ast":null,"code":"import \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/select/style\";\nimport _Select from \"antd/es/select\";\nimport \"antd/es/row/style\";\nimport _Row from \"antd/es/row\";\nimport \"antd/es/col/style\";\nimport _Col from \"antd/es/col\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/dashboard/profile/FormEditInfo.jsx\";\n\nimport React from 'react';\nimport { withTranslation } from 'react-i18next';\nimport { client, M_UPDATE_INFO, Q_ROLES } from '@graphql';\nimport { returnError, newNotification, parseError, isSupperAdmin, hasPermission } from '@utils';\nimport { ROLE_TYPE, ROLE, PER } from '@constants';\nimport { observer, inject } from 'mobx-react';\nvar FormEditInfo = (_dec = inject(function (_ref) {\n  var stores = _ref.stores;\n  return stores;\n}), _dec(_class = observer(_class = (_temp = /*#__PURE__*/function (_React$Component) {\n  _inherits(FormEditInfo, _React$Component);\n\n  var _super = _createSuper(FormEditInfo);\n\n  function FormEditInfo() {\n    var _this;\n\n    _classCallCheck(this, FormEditInfo);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      loading: false,\n      roles: []\n    };\n\n    _this._queryRolesApp = function () {\n      client.query({\n        query: Q_ROLES,\n        fetchPolicy: 'network-only',\n        variables: {\n          type: 'ROLE_APP'\n        }\n      }).then(function (_ref2) {\n        var roles = _ref2.data.roles;\n\n        if (!roles) {\n          throw new Error('notification.queryRoleError');\n        }\n\n        _this.setState({\n          roles: roles.filter(function (role) {\n            return role.code !== ROLE.R_SUPPERADMIN;\n          })\n        });\n      }).catch(function (error) {\n        return returnError('users', {\n          error: error,\n          errorMessage: _this.props.i18n.t(parseError(error))\n        }, {\n          container: 'top-right'\n        });\n      });\n    };\n\n    _this.handleSubmit = function (e) {\n      e.preventDefault();\n\n      _this.props.form.validateFields(function (err, values) {\n        if (!err) {\n          var _this$props$user;\n\n          _this.setState({\n            loading: true\n          });\n\n          client.mutate({\n            mutation: M_UPDATE_INFO,\n            variables: {\n              userId: (_this$props$user = _this.props.user) === null || _this$props$user === void 0 ? void 0 : _this$props$user._id,\n              updateUser: {\n                firstname: values.firstname,\n                lastname: values.lastname,\n                phoneNumber: values.phoneNumber,\n                roleCode: values.roleCode,\n                email: values.email\n              }\n            }\n          }).then(function (e) {\n            if (e) {\n              _this.setState({\n                loading: false\n              });\n            }\n\n            var _assertThisInitialize = _assertThisInitialized(_this),\n                _assertThisInitialize2 = _assertThisInitialize.props,\n                handleToggleEditInfo = _assertThisInitialize2.handleToggleEditInfo,\n                queryMyInfo = _assertThisInitialize2.queryMyInfo,\n                queryUser = _assertThisInitialize2.queryUser,\n                resetFields = _assertThisInitialize2.form.resetFields;\n\n            newNotification(_this.props.i18n.t('notification.updateInfoSuccess'), 'success', {\n              container: 'top-right'\n            });\n            resetFields();\n            handleToggleEditInfo();\n            queryMyInfo ? queryMyInfo() : queryUser();\n          }).catch(function (errors) {\n            _this.setState({\n              loading: false\n            });\n\n            returnError('Error', {\n              errorMessage: _this.props.i18n.t(parseError(errors))\n            }, {\n              container: 'top-right'\n            });\n            return false;\n          });\n        }\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(FormEditInfo, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this._queryRolesApp();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _user$profiles$find,\n          _user$profiles$find$r,\n          _user$profiles$find2,\n          _user$profiles$find2$,\n          _this2 = this;\n\n      var _this$props = this.props,\n          i18n = _this$props.i18n,\n          getFieldDecorator = _this$props.form.getFieldDecorator,\n          handleToggleEditInfo = _this$props.handleToggleEditInfo,\n          user = _this$props.user,\n          myInfo = _this$props.globalState.myInfo,\n          roles = this.state.roles;\n      var userEditingIsSupperAdmin = (user === null || user === void 0 ? void 0 : (_user$profiles$find = user.profiles.find(function (profile) {\n        var _profile$role;\n\n        return (profile === null || profile === void 0 ? void 0 : (_profile$role = profile.role) === null || _profile$role === void 0 ? void 0 : _profile$role.type) === ROLE_TYPE.ROLE_APP;\n      })) === null || _user$profiles$find === void 0 ? void 0 : (_user$profiles$find$r = _user$profiles$find.role) === null || _user$profiles$find$r === void 0 ? void 0 : _user$profiles$find$r.code) === ROLE.R_SUPPERADMIN;\n      var profiles = myInfo === null || myInfo === void 0 ? void 0 : myInfo.profiles;\n      var isAllowAssignRole = !userEditingIsSupperAdmin && (isSupperAdmin(profiles) || hasPermission(profiles, PER.P_USER_EDIT));\n      return /*#__PURE__*/React.createElement(_Form, {\n        onSubmit: this.handleSubmit,\n        ref: \"form\",\n        style: {\n          width: '380px'\n        },\n        className: \"common-form form-edit-user\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(_Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(_Col, {\n        span: 12,\n        style: {\n          paddingRight: '10px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(_Form.Item, {\n        label: i18n.t('user.firstname'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 13\n        }\n      }, getFieldDecorator('firstname', {\n        initialValue: user === null || user === void 0 ? void 0 : user.firstname,\n        rules: [{\n          required: true,\n          message: i18n.t('require.requireFirstname')\n        }]\n      })( /*#__PURE__*/React.createElement(_Input, {\n        placeholder: i18n.t('user.firstname'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 18\n        }\n      })))), /*#__PURE__*/React.createElement(_Col, {\n        span: 12,\n        style: {\n          paddingLeft: '10px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(_Form.Item, {\n        label: i18n.t('user.lastname'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 13\n        }\n      }, getFieldDecorator('lastname', {\n        initialValue: user === null || user === void 0 ? void 0 : user.lastname,\n        rules: [{\n          required: true,\n          message: i18n.t('require.requireLastname')\n        }]\n      })( /*#__PURE__*/React.createElement(_Input, {\n        placeholder: i18n.t('user.lastname'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 18\n        }\n      }))))), /*#__PURE__*/React.createElement(_Form.Item, {\n        label: \"Email\",\n        style: {\n          marginTop: '6px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 9\n        }\n      }, getFieldDecorator('email', {\n        initialValue: user === null || user === void 0 ? void 0 : user.email,\n        rules: [{\n          type: 'email',\n          message: i18n.t('require.requireEmailCorrect')\n        }, {\n          required: true,\n          message: i18n.t('require.requireEmail')\n        }]\n      })( /*#__PURE__*/React.createElement(_Input, {\n        placeholder: \"ABC@example.com\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 14\n        }\n      }))), /*#__PURE__*/React.createElement(_Form.Item, {\n        label: i18n.t('user.phoneNumber'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 9\n        }\n      }, getFieldDecorator('phoneNumber', {\n        initialValue: user === null || user === void 0 ? void 0 : user.phoneNumber,\n        rules: [{\n          required: true,\n          message: i18n.t('require.requirePhone')\n        }, {\n          pattern: new RegExp('[+0-9]+'),\n          message: i18n.t('require.requirePhoneValid')\n        }]\n      })( /*#__PURE__*/React.createElement(_Input, {\n        placeholder: i18n.t('user.phoneNumber'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 14\n        }\n      }))), isAllowAssignRole && /*#__PURE__*/React.createElement(_Form.Item, {\n        label: i18n.t('user.role'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 11\n        }\n      }, getFieldDecorator('roleCode', {\n        initialValue: user === null || user === void 0 ? void 0 : (_user$profiles$find2 = user.profiles.find(function (profile) {\n          var _profile$role2;\n\n          return (profile === null || profile === void 0 ? void 0 : (_profile$role2 = profile.role) === null || _profile$role2 === void 0 ? void 0 : _profile$role2.type) === ROLE_TYPE.ROLE_APP;\n        })) === null || _user$profiles$find2 === void 0 ? void 0 : (_user$profiles$find2$ = _user$profiles$find2.role) === null || _user$profiles$find2$ === void 0 ? void 0 : _user$profiles$find2$.code,\n        rules: [{\n          required: true\n        }]\n      })( /*#__PURE__*/React.createElement(_Select, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 15\n        }\n      }, roles.map(function (e) {\n        return /*#__PURE__*/React.createElement(_Select.Option, {\n          key: e.code,\n          value: e.code,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 19\n          }\n        }, e.name);\n      })))), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          display: 'flex',\n          flexDirection: 'row',\n          alignItems: 'center',\n          marginTop: '20px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(_Form.Item, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(_Button, {\n        disabled: this.state.loading,\n        type: \"primary\",\n        htmlType: \"submit\",\n        className: \"btn-save\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 13\n        }\n      }, i18n.t('common.saveChanges'))), /*#__PURE__*/React.createElement(_Form.Item, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(_Button, {\n        className: \"btn-cancel\",\n        onClick: handleToggleEditInfo,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 13\n        }\n      }, i18n.t('common.cancel')))));\n    }\n  }]);\n\n  return FormEditInfo;\n}(React.Component), _temp)) || _class) || _class);\nexport default _Form.create({\n  name: 'normal_login'\n})(withTranslation()(FormEditInfo));","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/dashboard/profile/FormEditInfo.jsx"],"names":["React","withTranslation","client","M_UPDATE_INFO","Q_ROLES","returnError","newNotification","parseError","isSupperAdmin","hasPermission","ROLE_TYPE","ROLE","PER","observer","inject","FormEditInfo","stores","state","loading","roles","_queryRolesApp","query","fetchPolicy","variables","type","then","data","Error","setState","filter","role","code","R_SUPPERADMIN","catch","error","errorMessage","props","i18n","t","container","handleSubmit","e","preventDefault","form","validateFields","err","values","mutate","mutation","userId","user","_id","updateUser","firstname","lastname","phoneNumber","roleCode","email","handleToggleEditInfo","queryMyInfo","queryUser","resetFields","errors","getFieldDecorator","myInfo","globalState","userEditingIsSupperAdmin","profiles","find","profile","ROLE_APP","isAllowAssignRole","P_USER_EDIT","width","paddingRight","initialValue","rules","required","message","paddingLeft","marginTop","pattern","RegExp","map","name","display","flexDirection","alignItems","Component","create"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { withTranslation } from 'react-i18next'\nimport { Form, Input, Button, Row, Col, Select } from 'antd'\n\nimport { client, M_UPDATE_INFO, Q_ROLES } from '@graphql'\nimport { returnError, newNotification, parseError, isSupperAdmin, hasPermission } from '@utils'\nimport { ROLE_TYPE, ROLE, PER } from '@constants'\nimport { observer, inject } from 'mobx-react'\n\n@inject(({ stores }) => stores)\n@observer\nclass FormEditInfo extends React.Component {\n  state = {\n    loading: false,\n    roles: []\n  }\n\n  _queryRolesApp = () => {\n    client\n      .query({\n        query: Q_ROLES,\n        fetchPolicy: 'network-only',\n        variables: {\n          type: 'ROLE_APP'\n        }\n      })\n      .then(({ data: { roles } }) => {\n        if (!roles) {\n          throw new Error('notification.queryRoleError')\n        }\n        this.setState({ roles: roles.filter(role => role.code !== ROLE.R_SUPPERADMIN) })\n      })\n      .catch(error =>\n        returnError(\n          'users',\n          { error, errorMessage: this.props.i18n.t(parseError(error)) },\n          { container: 'top-right' }\n        )\n      )\n  }\n\n  componentDidMount() {\n    this._queryRolesApp()\n  }\n\n\n  handleSubmit = e => {\n    e.preventDefault()\n    this.props.form.validateFields((err, values) => {\n      if (!err) {\n        this.setState({ loading: true })\n        client\n          .mutate({\n            mutation: M_UPDATE_INFO,\n            variables: {\n              userId: this.props.user?._id,\n              updateUser: {\n                firstname: values.firstname,\n                lastname: values.lastname,\n                phoneNumber: values.phoneNumber,\n                roleCode: values.roleCode,\n                email: values.email\n              }\n            }\n          })\n          .then(e => {\n            if (e) {\n              this.setState({ loading: false })\n            }\n            const {\n              props: {\n                handleToggleEditInfo,\n                queryMyInfo,\n                queryUser,\n                form: { resetFields }\n              }\n            } = this\n            newNotification(this.props.i18n.t('notification.updateInfoSuccess'), 'success', {\n              container: 'top-right'\n            })\n            resetFields()\n            handleToggleEditInfo()\n            queryMyInfo ? queryMyInfo() : queryUser()\n          })\n          .catch(errors => {\n            this.setState({ loading: false })\n            returnError(\n              'Error',\n              {\n                errorMessage: this.props.i18n.t(parseError(errors))\n              },\n              { container: 'top-right' }\n            )\n            return false\n          })\n      }\n    })\n  }\n\n  render() {\n    const {\n      props: {\n        i18n,\n        form: { getFieldDecorator },\n        handleToggleEditInfo,\n        user,\n        globalState: { myInfo }\n      },\n      state: {\n        roles\n      }\n    } = this\n\n\n    const userEditingIsSupperAdmin = user?.profiles.find(profile => profile?.role?.type === ROLE_TYPE.ROLE_APP)?.role?.code === ROLE.R_SUPPERADMIN\n\n    const profiles = myInfo?.profiles\n    const isAllowAssignRole = !userEditingIsSupperAdmin && (isSupperAdmin(profiles) || hasPermission(profiles, PER.P_USER_EDIT))\n\n    return (\n      <Form onSubmit={this.handleSubmit} ref='form' style={{ width: '380px' }} className='common-form form-edit-user'>\n        <Row>\n          <Col span={12} style={{ paddingRight: '10px' }}>\n            <Form.Item label={i18n.t('user.firstname')}>\n              {getFieldDecorator('firstname', {\n                initialValue: user?.firstname,\n                rules: [\n                  {\n                    required: true,\n                    message: i18n.t('require.requireFirstname')\n                  }\n                ]\n              })(<Input placeholder={i18n.t('user.firstname')} />)}\n            </Form.Item>\n          </Col>\n          <Col span={12} style={{ paddingLeft: '10px' }}>\n            <Form.Item label={i18n.t('user.lastname')}>\n              {getFieldDecorator('lastname', {\n                initialValue: user?.lastname,\n                rules: [\n                  {\n                    required: true,\n                    message: i18n.t('require.requireLastname')\n                  }\n                ]\n              })(<Input placeholder={i18n.t('user.lastname')} />)}\n            </Form.Item>\n          </Col>\n        </Row>\n        <Form.Item label='Email' style={{ marginTop: '6px' }}>\n          {getFieldDecorator('email', {\n            initialValue: user?.email,\n            rules: [\n              {\n                type: 'email',\n                message: i18n.t('require.requireEmailCorrect')\n              },\n              {\n                required: true,\n                message: i18n.t('require.requireEmail')\n              }\n            ]\n          })(<Input placeholder='ABC@example.com' />)}\n        </Form.Item>\n        <Form.Item label={i18n.t('user.phoneNumber')}>\n          {getFieldDecorator('phoneNumber', {\n            initialValue: user?.phoneNumber,\n            rules: [\n              {\n                required: true,\n                message: i18n.t('require.requirePhone')\n              },\n              {\n                pattern: new RegExp('[+0-9]+'),\n                message: i18n.t('require.requirePhoneValid')\n              }\n            ]\n          })(<Input placeholder={i18n.t('user.phoneNumber')} />)}\n        </Form.Item>\n\n        {isAllowAssignRole && (\n          <Form.Item label={i18n.t('user.role')}>\n            {getFieldDecorator('roleCode', {\n              initialValue: user?.profiles.find(profile => profile?.role?.type === ROLE_TYPE.ROLE_APP)?.role?.code,\n              rules: [\n                {\n                  required: true\n                }\n              ]\n            })(\n              <Select>\n                {roles.map(e => (\n                  <Select.Option key={e.code} value={e.code}>\n                    {e.name}\n                  </Select.Option>\n                ))}\n              </Select>\n            )}\n          </Form.Item>\n        )}\n\n        <div\n          style={{\n            display: 'flex',\n            flexDirection: 'row',\n            alignItems: 'center',\n            marginTop: '20px'\n          }}\n        >\n          <Form.Item>\n            <Button disabled={this.state.loading} type='primary' htmlType='submit' className='btn-save'>\n              {i18n.t('common.saveChanges')}\n            </Button>\n          </Form.Item>\n          <Form.Item>\n            <Button className='btn-cancel' onClick={handleToggleEditInfo}>\n              {i18n.t('common.cancel')}\n            </Button>\n          </Form.Item>\n        </div>\n      </Form>\n    )\n  }\n}\n\n\nexport default Form.create({ name: 'normal_login' })(withTranslation()(FormEditInfo))\n"]},"metadata":{},"sourceType":"module"}