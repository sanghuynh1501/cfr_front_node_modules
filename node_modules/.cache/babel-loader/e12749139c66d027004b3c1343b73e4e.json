{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/switch/style\";\nimport _Switch from \"antd/es/switch\";\nimport \"antd/es/row/style\";\nimport _Row from \"antd/es/row\";\nimport \"antd/es/col/style\";\nimport _Col from \"antd/es/col\";\nimport _objectSpread from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/conference2/modals/ModalPermission.jsx\";\n\nimport React from 'react';\nimport { inject, observer } from 'mobx-react';\nimport './ModalPermission.less';\nimport { client, Q_CONFERENCE_ROLES, M_CONFERENCE_AUTHORIZE } from '@graphql';\nimport { returnError, newNotification } from '@utils';\nimport { PERMISSIONS } from '@constants'; // import permissionIcon from '@misc/images/action/permission.svg'\n\nvar ModalPermission = (_dec = inject(function (_ref) {\n  var stores = _ref.stores;\n  return stores;\n}), _dec(_class = observer(_class = (_temp = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(ModalPermission, _React$PureComponent);\n\n  var _super = _createSuper(ModalPermission);\n\n  function ModalPermission() {\n    var _this;\n\n    _classCallCheck(this, ModalPermission);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      visible: false,\n      isUpdate: false,\n      permissionRole: []\n    };\n\n    _this.queryManagementRoles = function () {\n      client.query({\n        query: Q_CONFERENCE_ROLES,\n        variables: {\n          conferenceId: _this.props.conferenceState.conference._id\n        },\n        fetchPolicy: 'network-only'\n      }).then(function (_ref2) {\n        var conferenceRoles = _ref2.data.conferenceRoles;\n\n        if (conferenceRoles) {\n          _this.setState({\n            permissionRole: _this.convertData(conferenceRoles)\n          });\n        }\n      }).catch(function (error) {\n        return returnError('Roles', {\n          error: error,\n          errorMessage: 'Cannot get users, try again later!'\n        }, {\n          container: 'top-center'\n        });\n      });\n    };\n\n    _this.mutationUpdatePermission = function (dataUpdate) {\n      client.mutate({\n        mutation: M_CONFERENCE_AUTHORIZE,\n        variables: {\n          conferenceId: _this.props.conferenceState.conference._id,\n          update: dataUpdate\n        }\n      }).then(function (_ref3) {\n        var conferenceAuthorize = _ref3.data.conferenceAuthorize;\n\n        if (conferenceAuthorize) {\n          _this.handleCancel();\n\n          _this.setState({\n            isUpdate: true\n          });\n\n          newNotification('Update permission success', 'success', {\n            container: 'top-right'\n          });\n        }\n      }).catch(function (error) {\n        return returnError('Roles', {\n          error: error,\n          errorMessage: 'Cannot get users, try again later!'\n        }, {\n          container: 'top-right'\n        });\n      });\n    };\n\n    _this.convertData = function (conferenceRoles) {\n      var _conferenceRoles$filt = conferenceRoles.filter(function (item) {\n        return item._id === 'MODERATOR';\n      }),\n          _conferenceRoles$filt2 = _slicedToArray(_conferenceRoles$filt, 1),\n          dataMor = _conferenceRoles$filt2[0];\n\n      var _conferenceRoles$filt3 = conferenceRoles.filter(function (item) {\n        return item._id === 'PARTICIPANT';\n      }),\n          _conferenceRoles$filt4 = _slicedToArray(_conferenceRoles$filt3, 1),\n          dataPar = _conferenceRoles$filt4[0];\n\n      var data = PERMISSIONS.map(function (item) {\n        return _objectSpread({}, item, {\n          moderator: dataMor.permissions.findIndex(function (i) {\n            return i._id === item.code;\n          }) !== -1,\n          participant: dataPar.permissions.findIndex(function (i) {\n            return i._id === item.code;\n          }) !== -1\n        });\n      });\n      return data;\n    };\n\n    _this.showModal = function () {\n      if (_this.state.isUpdate) {\n        _this.queryManagementRoles();\n      }\n\n      _this.setState({\n        visible: true\n      });\n    };\n\n    _this.handleOk = function (e) {\n      var permissionMod = [];\n      var permissionPar = [];\n      PERMISSIONS.map(function (item) {\n        if (_this.refs[item.code + '-MOD'].rcSwitch.state.checked) {\n          permissionMod.push(item.code);\n        }\n\n        return item;\n      });\n      PERMISSIONS.map(function (item) {\n        if (_this.refs[item.code + '-PAR'].rcSwitch.state.checked) {\n          permissionPar.push(item.code);\n        }\n\n        return item;\n      });\n\n      _this.mutationUpdatePermission([{\n        roleId: 'MODERATOR',\n        permissionIds: permissionMod\n      }, {\n        roleId: 'PARTICIPANT',\n        permissionIds: permissionPar\n      }]);\n    };\n\n    _this.handleCancel = function (e) {\n      _this.setState({\n        visible: false,\n        isUpdate: false\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(ModalPermission, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.showModalPermission(this.showModal);\n      this.queryManagementRoles();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"wrapper-permission-modal\",\n        key: Date.now(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(_Modal, {\n        title: \"Setting Permission\",\n        className: \"permission-modal\",\n        visible: this.state.visible,\n        onOk: this.handleOk,\n        onCancel: this.handleCancel,\n        okText: \"Save Changes\",\n        centered: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"wrapper-permission-table\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"permission-table-header\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(_Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(_Col, {\n        span: 12,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 17\n        }\n      }, \"Permission\"), /*#__PURE__*/React.createElement(_Col, {\n        span: 4,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 17\n        }\n      }, \"Owner\"), /*#__PURE__*/React.createElement(_Col, {\n        span: 4,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 17\n        }\n      }, \"Presenter\"), /*#__PURE__*/React.createElement(_Col, {\n        span: 4,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 17\n        }\n      }, \"Particitant\"))), this.state.permissionRole.map(function (item, index) {\n        return /*#__PURE__*/React.createElement(_Row, {\n          key: index,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 169,\n            columnNumber: 17\n          }\n        }, /*#__PURE__*/React.createElement(_Col, {\n          span: 12,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          className: \"permission-name\",\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 21\n          }\n        }, /*#__PURE__*/React.createElement(\"span\", {\n          className: \"permission-code\",\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 23\n          }\n        }, item.name))), /*#__PURE__*/React.createElement(_Col, {\n          span: 4,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(_Switch, {\n          key: \"\".concat(item.code, \"-QWN-\").concat(Date.now()),\n          ref: \"\".concat(item.code, \"-OWN\"),\n          defaultChecked: item.owner,\n          disabled: true,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 21\n          }\n        })), /*#__PURE__*/React.createElement(_Col, {\n          span: 4,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(_Switch, {\n          key: \"\".concat(item.code, \"-MOD-\").concat(Date.now()),\n          ref: \"\".concat(item.code, \"-MOD\"),\n          defaultChecked: item.moderator,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 21\n          }\n        })), /*#__PURE__*/React.createElement(_Col, {\n          span: 4,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(_Switch, {\n          key: \"\".concat(item.code, \"-PAR-\").concat(Date.now()),\n          ref: \"\".concat(item.code, \"-PAR\"),\n          defaultChecked: item.participant,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 21\n          }\n        })));\n      }))));\n    }\n  }]);\n\n  return ModalPermission;\n}(React.PureComponent), _temp)) || _class) || _class);\nexport default ModalPermission;","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/conference2/modals/ModalPermission.jsx"],"names":["React","inject","observer","client","Q_CONFERENCE_ROLES","M_CONFERENCE_AUTHORIZE","returnError","newNotification","PERMISSIONS","ModalPermission","stores","state","visible","isUpdate","permissionRole","queryManagementRoles","query","variables","conferenceId","props","conferenceState","conference","_id","fetchPolicy","then","conferenceRoles","data","setState","convertData","catch","error","errorMessage","container","mutationUpdatePermission","dataUpdate","mutate","mutation","update","conferenceAuthorize","handleCancel","filter","item","dataMor","dataPar","map","moderator","permissions","findIndex","i","code","participant","showModal","handleOk","e","permissionMod","permissionPar","refs","rcSwitch","checked","push","roleId","permissionIds","showModalPermission","Date","now","index","name","owner","PureComponent"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Modal, Row, Col, Switch } from 'antd'\nimport { inject, observer } from 'mobx-react'\nimport './ModalPermission.less'\n\nimport { client, Q_CONFERENCE_ROLES, M_CONFERENCE_AUTHORIZE } from '@graphql'\nimport { returnError, newNotification } from '@utils'\nimport { PERMISSIONS } from '@constants'\n\n// import permissionIcon from '@misc/images/action/permission.svg'\n\n@inject(({ stores }) => stores)\n@observer\nclass ModalPermission extends React.PureComponent {\n  state = {\n    visible: false,\n    isUpdate: false,\n    permissionRole: []\n  }\n\n  queryManagementRoles = () => {\n    client\n      .query({\n        query: Q_CONFERENCE_ROLES,\n        variables: {\n          conferenceId: this.props.conferenceState.conference._id\n        },\n        fetchPolicy: 'network-only'\n      })\n      .then(({ data: { conferenceRoles } }) => {\n        if (conferenceRoles) {\n          this.setState({ permissionRole: this.convertData(conferenceRoles) })\n        }\n      })\n      .catch(error =>\n        returnError(\n          'Roles',\n          { error, errorMessage: 'Cannot get users, try again later!' },\n          { container: 'top-center' }\n        )\n      )\n  }\n\n  mutationUpdatePermission = dataUpdate => {\n    client\n      .mutate({\n        mutation: M_CONFERENCE_AUTHORIZE,\n        variables: {\n          conferenceId: this.props.conferenceState.conference._id,\n          update: dataUpdate\n        }\n      })\n      .then(({ data: { conferenceAuthorize } }) => {\n        if (conferenceAuthorize) {\n          this.handleCancel()\n          this.setState({ isUpdate: true })\n          newNotification('Update permission success', 'success', {\n            container: 'top-right'\n          })\n        }\n      })\n      .catch(error =>\n        returnError(\n          'Roles',\n          { error, errorMessage: 'Cannot get users, try again later!' },\n          { container: 'top-right' }\n        )\n      )\n  }\n\n  componentDidMount() {\n    this.props.showModalPermission(this.showModal)\n    this.queryManagementRoles()\n  }\n\n  convertData = conferenceRoles => {\n    const [dataMor] = conferenceRoles.filter(item => item._id === 'MODERATOR')\n    const [dataPar] = conferenceRoles.filter(item => item._id === 'PARTICIPANT')\n\n    const data = PERMISSIONS.map(item => {\n      return {\n        ...item,\n        moderator:\n          dataMor.permissions.findIndex(i => i._id === item.code) !== -1,\n        participant:\n          dataPar.permissions.findIndex(i => i._id === item.code) !== -1\n      }\n    })\n\n    return data\n  }\n\n  showModal = () => {\n    if (this.state.isUpdate) {\n      this.queryManagementRoles()\n    }\n    this.setState({ visible: true })\n  }\n\n  handleOk = e => {\n    let permissionMod = []\n    let permissionPar = []\n\n    PERMISSIONS.map(item => {\n      if (this.refs[item.code + '-MOD'].rcSwitch.state.checked) {\n        permissionMod.push(item.code)\n      }\n      return item\n    })\n\n    PERMISSIONS.map(item => {\n      if (this.refs[item.code + '-PAR'].rcSwitch.state.checked) {\n        permissionPar.push(item.code)\n      }\n      return item\n    })\n\n    this.mutationUpdatePermission([\n      {\n        roleId: 'MODERATOR',\n        permissionIds: permissionMod\n      },\n      {\n        roleId: 'PARTICIPANT',\n        permissionIds: permissionPar\n      }\n    ])\n  }\n\n  handleCancel = e => {\n    this.setState({\n      visible: false,\n      isUpdate: false\n    })\n  }\n\n\n  render() {\n    return (\n      <div className='wrapper-permission-modal' key={Date.now()}>\n        {/* <div className='action-item action-item-micro'>\n          <div className='bg-micro' />\n          <Tooltip title='Setting Permission'>\n            <Button type='primary' onClick={this.showModal}>\n              <img src={permissionIcon} alt='icon' />\n            </Button>\n          </Tooltip>\n        </div> */}\n        <Modal\n          title='Setting Permission'\n          className='permission-modal'\n          visible={this.state.visible}\n          onOk={this.handleOk}\n          onCancel={this.handleCancel}\n          okText='Save Changes'\n          centered\n        >\n          <div className='wrapper-permission-table'>\n            <div className='permission-table-header'>\n              <Row>\n                <Col span={12}>Permission</Col>\n                <Col span={4}>Owner</Col>\n                <Col span={4}>Presenter</Col>\n                <Col span={4}>Particitant</Col>\n              </Row>\n            </div>\n            {this.state.permissionRole.map((item, index) => {\n              return (\n                <Row key={index}>\n                  <Col span={12}>\n                    <div className='permission-name'>\n                      <span className='permission-code'>{item.name}</span>\n                      {/* <span className='permission-description'>{`Code: ${item.code}`}</span> */}\n                    </div>\n                  </Col>\n                  <Col span={4}>\n                    <Switch\n                      key={`${item.code}-QWN-${Date.now()}`}\n                      ref={`${item.code}-OWN`}\n                      defaultChecked={item.owner}\n                      disabled\n                    />\n                  </Col>\n                  <Col span={4}>\n                    <Switch\n                      key={`${item.code}-MOD-${Date.now()}`}\n                      ref={`${item.code}-MOD`}\n                      defaultChecked={item.moderator}\n                    />\n                  </Col>\n                  <Col span={4}>\n                    <Switch\n                      key={`${item.code}-PAR-${Date.now()}`}\n                      ref={`${item.code}-PAR`}\n                      defaultChecked={item.participant}\n                    />\n                  </Col>\n                </Row>\n              )\n            })}\n          </div>\n        </Modal>\n      </div>\n    )\n  }\n}\n\nexport default ModalPermission\n"]},"metadata":{},"sourceType":"module"}