{"ast":null,"code":"import \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport _objectSpread from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _regeneratorRuntime from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport \"antd/es/select/style\";\nimport _Select from \"antd/es/select\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/dashboard/recordings/index.jsx\";\n\nimport React from 'react';\nimport moment from 'moment';\nimport './index.less';\nimport client, { Q_RECORDS_PRIVATE, M_DELTE_RECORD, M_STOP_RECORD } from '@graphql';\nimport { newNotification, parseError, isSupperAdmin, hasPermission } from '@utils';\nimport { timeToString } from '@pages/conference2/jitsi/components/DropdownRecord';\nimport iconDownload from \"@misc/images/download.svg\";\nimport iconShare from \"@misc/images/share_record.svg\";\nimport iconSetting from \"@misc/images/setting-green.svg\";\nimport ModalShareRecord from './ModalShareRecord';\nimport { withTranslation } from 'react-i18next';\nimport { PER } from '@constants';\nimport ModalSettingRecord from './ModalSettingRecord';\nimport { inject, observer } from 'mobx-react';\nvar Option = _Select.Option;\nvar Search = _Input.Search;\nvar confirm = _Modal.confirm;\nvar RECORD_DONE = 3;\nvar Recording = (_dec = inject(function (_ref) {\n  var stores = _ref.stores;\n  return stores;\n}), _dec(_class = observer(_class = (_temp = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(Recording, _React$PureComponent);\n\n  var _super = _createSuper(Recording);\n\n  function Recording(props) {\n    var _this;\n\n    _classCallCheck(this, Recording);\n\n    _this = _super.call(this, props);\n\n    _this.queryRecordings = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(inputSearch) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                client.query({\n                  query: Q_RECORDS_PRIVATE,\n                  fetchPolicy: 'network-only',\n                  variables: {\n                    inputSearch: inputSearch\n                  }\n                }).then(function (_ref3) {\n                  var data = _ref3.data;\n\n                  _this.setState({\n                    records: data.recordsPrivate\n                  });\n                }).catch(function (err) {\n                  var message = err === null || err === void 0 ? void 0 : err.graphQLErrors.map(function (er) {\n                    return er.message;\n                  }).join(',');\n                  return newNotification(_this.props.i18n.t(message), 'danger');\n                });\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.handleSelectFilter = function (value) {\n      _this.setState(function (prevState) {\n        return {\n          inputSearch: _objectSpread({}, prevState.inputSearch, {\n            view: value\n          })\n        };\n      }, function () {\n        _this.queryRecordings(_this.state.inputSearch);\n      });\n    };\n\n    _this.componentDidMount = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _this.queryRecordings(_this.state.inputSearch);\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    _this.handleStopRecord = function (conferenceId) {\n      client.mutate({\n        mutation: M_STOP_RECORD,\n        variables: {\n          conferenceId: conferenceId\n        }\n      }).then( /*#__PURE__*/function () {\n        var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(res) {\n          var _res$data;\n\n          return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  if (!(res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.stopRecord)) {\n                    _context3.next = 4;\n                    break;\n                  }\n\n                  _context3.next = 3;\n                  return _this.queryRecordings(_this.state.inputSearch);\n\n                case 3:\n                  return _context3.abrupt(\"return\", newNotification('Đã tắt ghi hình!', 'success'));\n\n                case 4:\n                  throw new Error('Có lỗi xảy ra!');\n\n                case 5:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, _callee3);\n        }));\n\n        return function (_x2) {\n          return _ref5.apply(this, arguments);\n        };\n      }()).catch( /*#__PURE__*/function () {\n        var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(err) {\n          return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  newNotification(_this.props.i18n.t(parseError(err)), 'danger');\n                  _context4.next = 3;\n                  return _this.queryRecordings(_this.state.inputSearch);\n\n                case 3:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n\n        return function (_x3) {\n          return _ref6.apply(this, arguments);\n        };\n      }());\n    };\n\n    _this.handleDeleteRecord = function (recordId) {\n      var _assertThisInitialize = _assertThisInitialized(_this),\n          i18n = _assertThisInitialize.props.i18n,\n          inputSearch = _assertThisInitialize.state.inputSearch,\n          queryRecordings = _assertThisInitialize.queryRecordings;\n\n      confirm({\n        title: 'Delete Recording',\n        content: 'Do you want to delete the recording ?',\n        onOk: function onOk() {\n          client.mutate({\n            mutation: M_DELTE_RECORD,\n            variables: {\n              recordId: recordId\n            }\n          }).then(function (_ref7) {\n            var data = _ref7.data;\n\n            if (!data.deleteRecord) {\n              throw new Error('Xóa bản ghi thất bại.');\n            }\n\n            newNotification('Xóa bản ghi thành công.', 'success');\n            queryRecordings(inputSearch);\n          }).catch(function (err) {\n            newNotification(i18n.t(parseError(err)), 'danger');\n          });\n        }\n      });\n    };\n\n    _this.handleSearchText = /*#__PURE__*/function () {\n      var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(text) {\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _this.setState(function (prevState) {\n                  return {\n                    inputSearch: _objectSpread({}, prevState.inputSearch, {\n                      textSearch: text\n                    })\n                  };\n                }, function () {\n                  _this.queryRecordings(_this.state.inputSearch);\n                });\n\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      return function (_x4) {\n        return _ref8.apply(this, arguments);\n      };\n    }();\n\n    _this.state = {\n      records: [],\n      inputSearch: null\n    };\n    return _this;\n  }\n\n  _createClass(Recording, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          i18n = _this$props.i18n,\n          myInfo = _this$props.globalState.myInfo;\n      var columns = [{\n        title: i18n.t('recording.name'),\n        dataIndex: 'name'\n      }, {\n        title: 'Code',\n        dataIndex: 'conference.code'\n      }, {\n        title: i18n.t('recording.date'),\n        dataIndex: 'createdAt',\n        render: function render(date) {\n          return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 152,\n              columnNumber: 13\n            }\n          }, moment(date).format('DD/MM/YYYY')), /*#__PURE__*/React.createElement(\"div\", {\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 153,\n              columnNumber: 13\n            }\n          }, moment(date).format('HH:MM:SS')));\n        }\n      }, {\n        title: i18n.t('recording.duration'),\n        render: function render(data) {\n          return data.state === RECORD_DONE ? timeToString(data.duration) : '...';\n        }\n      }, // {\n      //   title: 'Size',\n      //   dataIndex: 'size',\n      //   render: time => '...'\n      // },\n      {\n        title: i18n.t('recording.owner'),\n        dataIndex: 'conference.createdBy.username'\n      }, {\n        render: function render(data) {\n          return /*#__PURE__*/React.createElement(\"div\", {\n            className: \"action-record\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 174,\n              columnNumber: 13\n            }\n          }, (myInfo === null || myInfo === void 0 ? void 0 : myInfo._id) === data.conference.createdBy._id && /*#__PURE__*/React.createElement(_Button, {\n            type: \"link\",\n            className: \"btn-share\",\n            onClick: function onClick() {\n              return _this2.showModalShareRecord(data._id);\n            },\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 176,\n              columnNumber: 17\n            }\n          }, /*#__PURE__*/React.createElement(\"img\", {\n            src: iconShare,\n            alt: \"icon\",\n            width: 15,\n            height: 16,\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 177,\n              columnNumber: 19\n            }\n          })), data.state === RECORD_DONE ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Button, {\n            type: \"link\",\n            style: {\n              border: 0,\n              outline: 0\n            },\n            onClick: function onClick() {\n              window.open(data.url);\n            },\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 183,\n              columnNumber: 19\n            }\n          }, /*#__PURE__*/React.createElement(\"img\", {\n            src: iconDownload,\n            alt: \"icon\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 21\n            }\n          })), (myInfo === null || myInfo === void 0 ? void 0 : myInfo._id) === data.conference.createdBy._id && /*#__PURE__*/React.createElement(_Button, {\n            style: {\n              borderRadius: 6,\n              outline: 0,\n              height: 30\n            },\n            type: \"primary\",\n            onClick: function onClick() {\n              return _this2.handleDeleteRecord(data._id);\n            },\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 194,\n              columnNumber: 21\n            }\n          }, i18n.t('common.delete'))) : /*#__PURE__*/React.createElement(React.Fragment, null, (myInfo === null || myInfo === void 0 ? void 0 : myInfo._id) === data.conference.createdBy._id && /*#__PURE__*/React.createElement(_Button, {\n            style: {\n              borderRadius: 6,\n              outline: 0,\n              height: 30\n            },\n            type: \"primary\",\n            onClick: function onClick() {\n              return _this2.handleStopRecord(data.conference._id);\n            },\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 206,\n              columnNumber: 23\n            }\n          }, \"Stop\")));\n        }\n      }];\n      var profiles = myInfo === null || myInfo === void 0 ? void 0 : myInfo.profiles;\n      var isAllowConfig = isSupperAdmin(profiles) || hasPermission(profiles, PER.P_SETTING_UPDATE);\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"wrapper-recording\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(ModalShareRecord, {\n        setRef: function setRef(ref) {\n          return _this2.showModalShareRecord = ref;\n        },\n        refetchRecords: this.queryRecordings,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 9\n        }\n      }), isAllowConfig && /*#__PURE__*/React.createElement(ModalSettingRecord, {\n        setRef: function setRef(ref) {\n          return _this2.showModalSetting = ref;\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"title-recording\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 9\n        }\n      }, i18n.t('recording.myRecording'), isAllowConfig && /*#__PURE__*/React.createElement(_Button, {\n        type: \"link\",\n        className: \"button-setting-record\",\n        size: 20,\n        onClick: function onClick() {\n          return _this2.showModalSetting();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        src: iconSetting,\n        alt: \"icon\",\n        width: 16,\n        height: 16,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 15\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"filter-recording\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(_Select, {\n        style: {\n          width: 200\n        },\n        placeholder: i18n.t('recording.filterRecord'),\n        onSelect: this.handleSelectFilter,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Option, {\n        value: \"ALL\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 13\n        }\n      }, i18n.t('recording.all')), /*#__PURE__*/React.createElement(Option, {\n        value: \"SHARE_WITH_ME\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 13\n        }\n      }, i18n.t('recording.shareWithMe')), /*#__PURE__*/React.createElement(Option, {\n        value: \"MY_RECORDING\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 13\n        }\n      }, i18n.t('recording.myRecord'))), /*#__PURE__*/React.createElement(Search, {\n        style: {\n          width: 310\n        },\n        placeholder: \"Nh\\u1EADp t\\xEAn cu\\u1ED9c h\\u1ECDp ho\\u1EB7c m\\xE3 cu\\u1ED9c h\\u1ECDp\",\n        onSearch: this.handleSearchText,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"wrapper-table\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(_Table, {\n        className: \"common-table\",\n        columns: columns,\n        dataSource: this.state.records,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 11\n        }\n      })));\n    }\n  }]);\n\n  return Recording;\n}(React.PureComponent), _temp)) || _class) || _class);\nexport default withTranslation()(Recording);","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/dashboard/recordings/index.jsx"],"names":["React","moment","client","Q_RECORDS_PRIVATE","M_DELTE_RECORD","M_STOP_RECORD","newNotification","parseError","isSupperAdmin","hasPermission","timeToString","ModalShareRecord","withTranslation","PER","ModalSettingRecord","inject","observer","Option","Search","confirm","RECORD_DONE","Recording","stores","props","queryRecordings","inputSearch","query","fetchPolicy","variables","then","data","setState","records","recordsPrivate","catch","err","message","graphQLErrors","map","er","join","i18n","t","handleSelectFilter","value","prevState","view","state","componentDidMount","handleStopRecord","conferenceId","mutate","mutation","res","stopRecord","Error","handleDeleteRecord","recordId","title","content","onOk","deleteRecord","handleSearchText","text","textSearch","myInfo","globalState","columns","dataIndex","render","date","format","duration","_id","conference","createdBy","showModalShareRecord","iconShare","border","outline","window","open","url","iconDownload","borderRadius","height","profiles","isAllowConfig","P_SETTING_UPDATE","ref","showModalSetting","iconSetting","width","PureComponent"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Select, Button, Table, Input, Modal } from 'antd'\nimport moment from 'moment'\nimport './index.less'\nimport client, { Q_RECORDS_PRIVATE, M_DELTE_RECORD, M_STOP_RECORD } from '@graphql'\nimport { newNotification, parseError, isSupperAdmin, hasPermission } from '@utils'\nimport { timeToString } from '@pages/conference2/jitsi/components/DropdownRecord'\nimport iconDownload from '@misc/images/download.svg'\nimport iconShare from '@misc/images/share_record.svg'\nimport iconSetting from '@misc/images/setting-green.svg'\nimport ModalShareRecord from './ModalShareRecord'\nimport { withTranslation } from 'react-i18next'\nimport { PER } from '@constants'\nimport ModalSettingRecord from './ModalSettingRecord'\nimport { inject, observer } from 'mobx-react'\n\nconst { Option } = Select\nconst { Search } = Input\nconst { confirm } = Modal;\n\nconst RECORD_DONE = 3\n\n@inject(({ stores }) => stores)\n@observer\nclass Recording extends React.PureComponent {\n  constructor(props) {\n    super(props)\n    this.state = {\n      records: [],\n      inputSearch: null\n    }\n  }\n\n  queryRecordings = async inputSearch => {\n    client\n      .query({\n        query: Q_RECORDS_PRIVATE,\n        fetchPolicy: 'network-only',\n        variables: {\n          inputSearch\n        }\n      })\n      .then(({ data }) => {\n        this.setState({ records: data.recordsPrivate })\n      })\n      .catch(err => {\n        const message = err?.graphQLErrors.map(er => er.message).join(',')\n        return newNotification(this.props.i18n.t(message), 'danger')\n      })\n  }\n\n  handleSelectFilter = value => {\n    this.setState(prevState => ({\n      inputSearch: {\n        ...prevState.inputSearch,\n        view: value\n      }\n    }), () => {\n      this.queryRecordings(this.state.inputSearch)\n    })\n  }\n\n  componentDidMount = async () => {\n    await this.queryRecordings(this.state.inputSearch)\n  }\n\n  handleStopRecord = (conferenceId) => {\n    client\n      .mutate({\n        mutation: M_STOP_RECORD,\n        variables: {\n          conferenceId\n        }\n      })\n      .then(async res => {\n        if (res?.data?.stopRecord) {\n          await this.queryRecordings(this.state.inputSearch)\n          return newNotification('Đã tắt ghi hình!', 'success')\n        }\n        throw new Error('Có lỗi xảy ra!')\n      })\n      .catch(async err => {\n        newNotification(this.props.i18n.t(parseError(err)), 'danger')\n        await this.queryRecordings(this.state.inputSearch)\n      })\n  }\n\n  handleDeleteRecord = recordId => {\n    const {\n      props: { i18n },\n      state: { inputSearch },\n      queryRecordings\n    } = this\n\n    confirm({\n      title: 'Delete Recording',\n      content: 'Do you want to delete the recording ?',\n      onOk() {\n        client\n          .mutate({\n            mutation: M_DELTE_RECORD,\n            variables: {\n              recordId\n            }\n          }).then(({ data }) => {\n            if (!data.deleteRecord) {\n              throw new Error('Xóa bản ghi thất bại.')\n            }\n            newNotification('Xóa bản ghi thành công.', 'success')\n            queryRecordings(inputSearch)\n          }).catch(err => {\n            newNotification(i18n.t(parseError(err)), 'danger')\n          })\n      },\n    })\n  }\n\n  handleSearchText = async (text) => {\n    this.setState(prevState => ({\n      inputSearch: {\n        ...prevState.inputSearch,\n        textSearch: text\n      }\n    }), () => {\n      this.queryRecordings(this.state.inputSearch)\n    })\n  }\n\n\n  render() {\n    const {\n      i18n,\n      globalState: {\n        myInfo\n      }\n    } = this.props\n\n    const columns = [\n      {\n        title: i18n.t('recording.name'),\n        dataIndex: 'name'\n      },\n      {\n        title: 'Code',\n        dataIndex: 'conference.code'\n      },\n      {\n        title: i18n.t('recording.date'),\n        dataIndex: 'createdAt',\n        render: date => (\n          <>\n            <div>{moment(date).format('DD/MM/YYYY')}</div>\n            <div>{moment(date).format('HH:MM:SS')}</div>\n          </>\n        )\n      },\n      {\n        title: i18n.t('recording.duration'),\n        render: data => data.state === RECORD_DONE ? timeToString(data.duration) : '...'\n      },\n      // {\n      //   title: 'Size',\n      //   dataIndex: 'size',\n      //   render: time => '...'\n      // },\n\n      {\n        title: i18n.t('recording.owner'),\n        dataIndex: 'conference.createdBy.username'\n      },\n      {\n        render: data =>\n          (\n            <div className='action-record'>\n              {myInfo?._id === data.conference.createdBy._id && (\n                <Button type='link' className='btn-share' onClick={() => this.showModalShareRecord(data._id)}>\n                  <img src={iconShare} alt='icon' width={15} height={16} />\n                </Button>\n              )}\n\n              {data.state === RECORD_DONE ? (\n                <>\n                  <Button\n                    type='link'\n                    style={{ border: 0, outline: 0 }}\n                    onClick={() => {\n                      window.open(data.url)\n                    }}\n                  >\n                    <img src={iconDownload} alt='icon' />\n                  </Button>\n\n                  {myInfo?._id === data.conference.createdBy._id && (\n                    <Button\n                      style={{ borderRadius: 6, outline: 0, height: 30 }}\n                      type='primary'\n                      onClick={() => this.handleDeleteRecord(data._id)}\n                    >\n                      {i18n.t('common.delete')}\n                    </Button>\n                  )}\n                </>\n              ) : (\n                  <>\n                    {myInfo?._id === data.conference.createdBy._id && (\n                      <Button\n                        style={{ borderRadius: 6, outline: 0, height: 30 }}\n                        type='primary'\n                        onClick={() => this.handleStopRecord(data.conference._id)}\n                      >\n                        Stop\n                      </Button>\n                    )}\n                  </>\n                )}\n\n            </div>\n          )\n\n      }\n    ]\n\n    const profiles = myInfo?.profiles\n    const isAllowConfig = isSupperAdmin(profiles) || hasPermission(profiles, PER.P_SETTING_UPDATE)\n\n    return (\n      <div className='wrapper-recording'>\n        <ModalShareRecord\n          setRef={ref => this.showModalShareRecord = ref}\n          refetchRecords={this.queryRecordings}\n        />\n\n        {isAllowConfig && (\n          <ModalSettingRecord\n            setRef={ref => this.showModalSetting = ref}\n          />\n        )}\n\n        <div className='title-recording'>{i18n.t('recording.myRecording')}\n          {isAllowConfig && (\n            <Button\n              type=\"link\"\n              className='button-setting-record'\n              size={20}\n              onClick={() => this.showModalSetting()}\n            >\n              <img src={iconSetting} alt='icon' width={16} height={16} />\n            </Button>\n          )}\n        </div>\n\n\n\n\n        <div className='filter-recording'>\n          <Select\n            style={{ width: 200 }}\n            placeholder={i18n.t('recording.filterRecord')}\n            onSelect={this.handleSelectFilter}\n          >\n            <Option value='ALL'>{i18n.t('recording.all')}</Option>\n            <Option value='SHARE_WITH_ME'>{i18n.t('recording.shareWithMe')}</Option>\n            <Option value='MY_RECORDING'>{i18n.t('recording.myRecord')}</Option>\n          </Select>\n\n          <Search\n            style={{ width: 310 }}\n            placeholder='Nhập tên cuộc họp hoặc mã cuộc họp'\n            onSearch={this.handleSearchText}\n          />\n        </div>\n\n        <div className='wrapper-table'>\n          <Table className='common-table' columns={columns} dataSource={this.state.records} />\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default withTranslation()(Recording)\n"]},"metadata":{},"sourceType":"module"}