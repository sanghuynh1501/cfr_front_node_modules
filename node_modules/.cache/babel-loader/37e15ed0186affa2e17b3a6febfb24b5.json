{"ast":null,"code":"import _toConsumableArray from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/conference2/modals/ModalVote.jsx\";\n\nimport React from 'react';\nimport { withTranslation } from 'react-i18next';\nimport { inject, observer } from 'mobx-react';\nimport './ModalVote.less';\nimport { client, M_TOGGLE_LOCK_POLL, M_VOTE, M_CLEAR_POLL, M_END_POLL } from '@graphql';\nimport { checkPermission } from '@constants';\nimport { returnError } from '@utils';\nimport iconClose from \"@misc/images/close.svg\";\nimport iconEnd from \"@misc/images/end-vote.svg\";\nimport iconShow from \"@misc/images/view.svg\";\nimport iconHide from \"@misc/images/hide.svg\";\nvar ModalVote = (_dec = inject(function (_ref) {\n  var stores = _ref.stores;\n  return stores;\n}), _dec(_class = observer(_class = (_temp = /*#__PURE__*/function (_React$Component) {\n  _inherits(ModalVote, _React$Component);\n\n  var _super = _createSuper(ModalVote);\n\n  function ModalVote() {\n    var _this;\n\n    _classCallCheck(this, ModalVote);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _this.handleClickOutside = function (event) {\n      if (_this.refs.vote && !_this.refs.vote.contains(event.target) && event.target.outerHTML.search('<img src=\"/static/media/chart.90881ce8.svg\" alt=\"icon\">') === -1) {\n        _this.props.handleToggleModalVote(_this.props.pollModalVisbile);\n      }\n    };\n\n    _this.handleToggleLock = function () {\n      // MUTATION: LOCK AND UNLOCK POLL\n      client.mutate({\n        mutation: M_TOGGLE_LOCK_POLL,\n        variables: {\n          pollId: _this.props.pollInfo._id\n        }\n      }).catch(function (error) {\n        return returnError('lockAndUnlockPoll', {\n          error: error,\n          errorMessage: 'Please try again later!'\n        });\n      });\n    };\n\n    _this.handleEndVote = function () {\n      // MUTATION: END VOTE\n      client.mutate({\n        mutation: M_END_POLL,\n        variables: {\n          pollId: _this.props.pollInfo._id\n        }\n      }).catch(function (error) {\n        return returnError('endPoll', {\n          error: error,\n          errorMessage: 'Please try again later!'\n        });\n      });\n    };\n\n    _this.handledVote = function (answerKey) {\n      // MUTATION:\n      client.mutate({\n        mutation: M_VOTE,\n        variables: {\n          pollId: _this.props.pollInfo._id,\n          answerKey: answerKey\n        }\n      }).catch(function (error) {\n        return returnError('vote', {\n          error: error,\n          errorMessage: 'Please try again later!'\n        });\n      });\n    };\n\n    _this.handleClearVote = function () {\n      // MUTATION: CLEAR VOTE\n      client.mutate({\n        mutation: M_CLEAR_POLL,\n        variables: {\n          pollId: _this.props.pollInfo._id\n        }\n      }).catch(function (error) {\n        return returnError('clearVotes', {\n          error: error,\n          errorMessage: 'Please try again later!'\n        });\n      });\n    };\n\n    _this.checkSelectVote = function () {\n      var _assertThisInitialize = _assertThisInitialized(_this),\n          _assertThisInitialize2 = _assertThisInitialize.props,\n          pollInfo = _assertThisInitialize2.pollInfo,\n          conferenceState = _assertThisInitialize2.conferenceState;\n\n      var result = pollInfo.userVotes.filter(function (item) {\n        return item.user._id === conferenceState.myUserId;\n      });\n      return result.length === 0 ? null : result[0].key;\n    };\n\n    _this.checkHighestVote = function () {\n      var _assertThisInitialize3 = _assertThisInitialized(_this),\n          pollInfo = _assertThisInitialize3.props.pollInfo;\n\n      var temp = pollInfo.userVotes.map(function (item) {\n        return pollInfo.userVotes.reduce(function (total, item1) {\n          return item1.key === item.key ? total + 1 : total;\n        }, 0);\n      });\n      return temp.length === 0 ? 0 : Math.max.apply(Math, _toConsumableArray(temp));\n    };\n\n    _this.countSelectVote = function (valueKey) {\n      var _assertThisInitialize4 = _assertThisInitialized(_this),\n          pollInfo = _assertThisInitialize4.props.pollInfo;\n\n      return pollInfo.userVotes.reduce(function (total, item) {\n        return item.key === valueKey ? total + 1 : total;\n      }, 0);\n    };\n\n    return _this;\n  }\n\n  _createClass(ModalVote, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      document.addEventListener('mousedown', this.handleClickOutside);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var styleVote = {\n        background: '#078FA5',\n        color: '#FFF'\n      };\n      var styleLock = {\n        width: '100%',\n        background: '#96DDDF'\n      };\n      var _this$props = this.props,\n          handleToggleModalVote = _this$props.handleToggleModalVote,\n          pollModalVisbile = _this$props.pollModalVisbile,\n          pollInfo = _this$props.pollInfo,\n          conferenceState = _this$props.conferenceState,\n          i18n = _this$props.i18n,\n          handledVote = this.handledVote,\n          checkSelectVote = this.checkSelectVote,\n          countSelectVote = this.countSelectVote,\n          checkHighestVote = this.checkHighestVote;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"modal-result-vote\",\n        ref: \"vote\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"modal-close\",\n        onClick: function onClick() {\n          return handleToggleModalVote(pollModalVisbile);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        src: iconClose,\n        alt: \"icon\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"modal-question\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 11\n        }\n      }, pollInfo.question), checkPermission(conferenceState.myPermissions, 'VOTE_REMOVE') ? /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"vote-close\",\n        onClick: this.handleEndVote,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        src: iconEnd,\n        alt: \"con\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 15\n        }\n      })) : null), /*#__PURE__*/React.createElement(\"ul\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 9\n        }\n      }, pollInfo.answers.map(function (item, i) {\n        var countSelect = countSelectVote(item.key);\n        return /*#__PURE__*/React.createElement(\"li\", {\n          key: i,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 15\n          }\n        }, /*#__PURE__*/React.createElement(\"button\", {\n          type: \"button\",\n          className: pollInfo.isLocked || !checkPermission(conferenceState.myPermissions, 'VOTE') ? 'response-button locked' : 'response-button',\n          disabled: pollInfo.isLocked || pollInfo.type === 'Attendance' || !checkPermission(conferenceState.myPermissions, 'VOTE'),\n          onClick: function onClick() {\n            return handledVote(item.key);\n          },\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 17\n          }\n        }, /*#__PURE__*/React.createElement(\"span\", {\n          className: \"response-fill\",\n          style: pollInfo.isLocked && countSelect === checkHighestVote() && countSelect > 0 ? styleLock : {},\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 19\n          }\n        }), /*#__PURE__*/React.createElement(\"p\", {\n          className: \"response-text\",\n          style: item.key === checkSelectVote() ? styleVote : {},\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 19\n          }\n        }, i + 1), /*#__PURE__*/React.createElement(\"p\", {\n          className: \"answer-text\",\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 19\n          }\n        }, item.value), /*#__PURE__*/React.createElement(\"p\", {\n          className: \"response-count\",\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 19\n          }\n        }, countSelect)));\n      })), pollInfo.type !== 'Attendance' ? /*#__PURE__*/React.createElement(\"div\", {\n        className: \"control-vote\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 11\n        }\n      }, checkPermission(conferenceState.myPermissions, 'VOTE_LOCK_UNLOCK') ? /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"block-vote\",\n        onClick: this.handleToggleLock,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        src: pollInfo.isLocked ? iconHide : iconShow,\n        alt: \"icon\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 17\n        }\n      }, pollInfo.isLocked ? i18n.t('unlockPoll') : i18n.t('lockPoll'))) : null, pollInfo.isLocked && checkPermission(conferenceState.myPermissions, 'VOTE_RESET') ? /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"reset-vote\",\n        onClick: this.handleClearVote,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 15\n        }\n      }, \"L\\xE0m m\\u1EDBi\") : null) : null, !checkPermission(conferenceState.myPermissions, 'VOTE_CREATE') && pollInfo.isLocked ? /*#__PURE__*/React.createElement(\"span\", {\n        className: \"notify-locked\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 11\n        }\n      }, \"Th\\u0103m d\\xF2 \\xFD ki\\u1EBFn \\u0111\\xE3 kh\\xF3a\") : null);\n    }\n  }]);\n\n  return ModalVote;\n}(React.Component), _temp)) || _class) || _class);\nexport default withTranslation()(ModalVote);","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/conference2/modals/ModalVote.jsx"],"names":["React","withTranslation","inject","observer","client","M_TOGGLE_LOCK_POLL","M_VOTE","M_CLEAR_POLL","M_END_POLL","checkPermission","returnError","ModalVote","stores","handleClickOutside","event","refs","vote","contains","target","outerHTML","search","props","handleToggleModalVote","pollModalVisbile","handleToggleLock","mutate","mutation","variables","pollId","pollInfo","_id","catch","error","errorMessage","handleEndVote","handledVote","answerKey","handleClearVote","checkSelectVote","conferenceState","result","userVotes","filter","item","user","myUserId","length","key","checkHighestVote","temp","map","reduce","total","item1","Math","max","countSelectVote","valueKey","document","addEventListener","styleVote","background","color","styleLock","width","i18n","iconClose","question","myPermissions","iconEnd","answers","i","countSelect","isLocked","type","value","iconHide","iconShow","t","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { withTranslation } from 'react-i18next'\nimport { inject, observer } from 'mobx-react'\nimport './ModalVote.less'\n\nimport { client, M_TOGGLE_LOCK_POLL, M_VOTE, M_CLEAR_POLL, M_END_POLL } from '@graphql'\nimport { checkPermission } from '@constants'\nimport { returnError } from '@utils'\n\nimport iconClose from '@misc/images/close.svg'\nimport iconEnd from '@misc/images/end-vote.svg'\nimport iconShow from '@misc/images/view.svg'\nimport iconHide from '@misc/images/hide.svg'\n\n@inject(({ stores }) => stores)\n@observer\nclass ModalVote extends React.Component {\n  componentDidMount() {\n    document.addEventListener('mousedown', this.handleClickOutside)\n  }\n\n  handleClickOutside = event => {\n    if (\n      this.refs.vote &&\n      !this.refs.vote.contains(event.target) &&\n      event.target.outerHTML.search('<img src=\"/static/media/chart.90881ce8.svg\" alt=\"icon\">') === -1\n    ) {\n      this.props.handleToggleModalVote(this.props.pollModalVisbile)\n    }\n  }\n\n  handleToggleLock = () => {\n    // MUTATION: LOCK AND UNLOCK POLL\n    client\n      .mutate({\n        mutation: M_TOGGLE_LOCK_POLL,\n        variables: {\n          pollId: this.props.pollInfo._id\n        }\n      })\n      .catch(error =>\n        returnError('lockAndUnlockPoll', {\n          error,\n          errorMessage: 'Please try again later!'\n        })\n      )\n  }\n\n  handleEndVote = () => {\n    // MUTATION: END VOTE\n    client\n      .mutate({\n        mutation: M_END_POLL,\n        variables: {\n          pollId: this.props.pollInfo._id\n        }\n      })\n      .catch(error =>\n        returnError('endPoll', {\n          error,\n          errorMessage: 'Please try again later!'\n        })\n      )\n  }\n\n  handledVote = answerKey => {\n    // MUTATION:\n    client\n      .mutate({\n        mutation: M_VOTE,\n        variables: {\n          pollId: this.props.pollInfo._id,\n          answerKey\n        }\n      })\n      .catch(error =>\n        returnError('vote', {\n          error,\n          errorMessage: 'Please try again later!'\n        })\n      )\n  }\n\n  handleClearVote = () => {\n    // MUTATION: CLEAR VOTE\n    client\n      .mutate({\n        mutation: M_CLEAR_POLL,\n        variables: {\n          pollId: this.props.pollInfo._id\n        }\n      })\n      .catch(error =>\n        returnError('clearVotes', {\n          error,\n          errorMessage: 'Please try again later!'\n        })\n      )\n  }\n\n  checkSelectVote = () => {\n    const {\n      props: { pollInfo, conferenceState }\n    } = this\n\n    const result = pollInfo.userVotes.filter(item => item.user._id === conferenceState.myUserId)\n    return result.length === 0 ? null : result[0].key\n  }\n\n  checkHighestVote = () => {\n    const {\n      props: { pollInfo }\n    } = this\n\n    const temp = pollInfo.userVotes.map(item => {\n      return pollInfo.userVotes.reduce((total, item1) => (item1.key === item.key ? total + 1 : total), 0)\n    })\n    return temp.length === 0 ? 0 : Math.max(...temp)\n  }\n\n  countSelectVote = valueKey => {\n    const {\n      props: { pollInfo }\n    } = this\n\n    return pollInfo.userVotes.reduce((total, item) => (item.key === valueKey ? total + 1 : total), 0)\n  }\n\n  render() {\n    const styleVote = {\n      background: '#078FA5',\n      color: '#FFF'\n    }\n\n    const styleLock = {\n      width: '100%',\n      background: '#96DDDF'\n    }\n\n    const {\n      props: { handleToggleModalVote, pollModalVisbile, pollInfo, conferenceState, i18n },\n      handledVote,\n      checkSelectVote,\n      countSelectVote,\n      checkHighestVote\n    } = this\n\n    return (\n      <div className='modal-result-vote' ref='vote'>\n        <button type='button' className='modal-close' onClick={() => handleToggleModalVote(pollModalVisbile)}>\n          <img src={iconClose} alt='icon' />\n        </button>\n        <div className='modal-question'>\n          <span>{pollInfo.question}</span>\n          {checkPermission(conferenceState.myPermissions, 'VOTE_REMOVE') ? (\n            <button type='button' className='vote-close' onClick={this.handleEndVote}>\n              <img src={iconEnd} alt='con' />\n            </button>\n          ) : null}\n        </div>\n        <ul>\n          {pollInfo.answers.map((item, i) => {\n            const countSelect = countSelectVote(item.key)\n            return (\n              <li key={i}>\n                <button\n                  type='button'\n                  className={\n                    pollInfo.isLocked || !checkPermission(conferenceState.myPermissions, 'VOTE')\n                      ? 'response-button locked'\n                      : 'response-button'\n                  }\n                  disabled={\n                    pollInfo.isLocked ||\n                    pollInfo.type === 'Attendance' ||\n                    !checkPermission(conferenceState.myPermissions, 'VOTE')\n                  }\n                  onClick={() => handledVote(item.key)}\n                >\n                  <span\n                    className='response-fill'\n                    style={pollInfo.isLocked && countSelect === checkHighestVote() && countSelect > 0 ? styleLock : {}}\n                  ></span>\n                  <p className='response-text' style={item.key === checkSelectVote() ? styleVote : {}}>\n                    {i + 1}\n                  </p>\n                  <p className='answer-text'>{item.value}</p>\n                  <p className='response-count'>{countSelect}</p>\n                </button>\n              </li>\n            )\n          })}\n        </ul>\n        {pollInfo.type !== 'Attendance' ? (\n          <div className='control-vote'>\n            {checkPermission(conferenceState.myPermissions, 'VOTE_LOCK_UNLOCK') ? (\n              <button type='button' className='block-vote' onClick={this.handleToggleLock}>\n                <img src={pollInfo.isLocked ? iconHide : iconShow} alt='icon' />\n                <span>{pollInfo.isLocked ? i18n.t('unlockPoll') : i18n.t('lockPoll')}</span>\n              </button>\n            ) : null}\n            {pollInfo.isLocked && checkPermission(conferenceState.myPermissions, 'VOTE_RESET') ? (\n              <button type='button' className='reset-vote' onClick={this.handleClearVote}>\n                Làm mới\n              </button>\n            ) : null}\n          </div>\n        ) : null}\n        {!checkPermission(conferenceState.myPermissions, 'VOTE_CREATE') && pollInfo.isLocked ? (\n          <span className='notify-locked'>Thăm dò ý kiến đã khóa</span>\n        ) : null}\n      </div>\n    )\n  }\n}\n\nexport default withTranslation()(ModalVote)\n"]},"metadata":{},"sourceType":"module"}