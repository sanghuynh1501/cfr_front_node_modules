{"ast":null,"code":"import _objectSpread from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/conference2/jitsi/SpeakerTrack.jsx\";\n\nimport React from 'react';\nimport { inject, observer } from 'mobx-react';\nimport { Video } from './media';\nimport Annotate from './components/Annotate';\nimport iconNoAvatar from \"@misc/images/no-avatar.svg\";\nimport { isBotRecord } from '@utils';\nvar SpeakerTrack = (_dec = inject(function (_ref) {\n  var stores = _ref.stores;\n  return stores;\n}), _dec(_class = observer(_class = (_temp = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(SpeakerTrack, _React$PureComponent);\n\n  var _super = _createSuper(SpeakerTrack);\n\n  function SpeakerTrack() {\n    var _this;\n\n    _classCallCheck(this, SpeakerTrack);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      zoomIndex: 1,\n      isMouseDown: false,\n      startX: 0,\n      startY: 0,\n      originX: 50,\n      originY: 50\n    };\n\n    _this.handleZoomOut = function () {\n      if (_this.state.zoomIndex === 1.2) {\n        _this.refs['box-scale'].style.transformOrigin = \"50% 50%\";\n      }\n\n      _this.setState(function (_preState) {\n        return _objectSpread({}, _preState, {\n          zoomIndex: _preState.zoomIndex - 0.2\n        });\n      });\n    };\n\n    _this.handleZoomIn = function () {\n      _this.setState(function (_preState) {\n        return _objectSpread({}, _preState, {\n          zoomIndex: _preState.zoomIndex + 0.2\n        });\n      });\n    };\n\n    _this.handleMouseDown = function (e) {\n      e.persist();\n      var originX = +_this.refs['box-scale'].style.transformOrigin.split(' ')[0].split('%')[0];\n      var originY = +_this.refs['box-scale'].style.transformOrigin.split(' ')[1].split('%')[0];\n      _this.refs['box-scale'].style.cursor = 'move';\n\n      _this.setState(function (_preState) {\n        return _objectSpread({}, _preState, {\n          isMouseDown: true,\n          startX: e.pageX,\n          startY: e.pageY,\n          originX: originX,\n          originY: originY\n        });\n      });\n    };\n\n    _this.handleMouseUp = function () {\n      var originX = +_this.refs['box-scale'].style.transformOrigin.split(' ')[0].split('%')[0];\n      var originY = +_this.refs['box-scale'].style.transformOrigin.split(' ')[1].split('%')[0];\n      _this.refs['box-scale'].style.cursor = 'pointer';\n\n      _this.setState(function (_preState) {\n        return _objectSpread({}, _preState, {\n          isMouseDown: false,\n          startX: 0,\n          startY: 0,\n          originX: originX,\n          originY: originY\n        });\n      });\n    };\n\n    _this.handleMouseMove = function (e) {\n      e.persist();\n      var _this$state = _this.state,\n          startX = _this$state.startX,\n          startY = _this$state.startY;\n      var scaleX = e.currentTarget.offsetWidth * (_this.state.zoomIndex - 1);\n      var scaleY = e.currentTarget.offsetHeight * (_this.state.zoomIndex - 1);\n      var currentOriginX = +_this.refs['box-scale'].style.transformOrigin.split(' ')[0].split('%')[0];\n      var currentOriginY = +_this.refs['box-scale'].style.transformOrigin.split(' ')[1].split('%')[0];\n      var tempX = Math.abs(e.pageX - startX) / scaleX * 100;\n      var tempY = Math.abs(e.pageY - startY) / scaleY * 100;\n      var resultX = currentOriginX;\n      var resultY = currentOriginY;\n\n      if (e.pageX - startX > 0 && e.pageY - startY > 0) {\n        resultX = _this.state.originX - tempX <= 0 ? 0 : _this.state.originX - tempX;\n        resultY = _this.state.originY - tempY <= 0 ? 0 : _this.state.originY - tempY;\n      }\n\n      if (e.pageX - startX < 0 && e.pageY - startY < 0) {\n        resultX = _this.state.originX + tempX >= 100 ? 100 : _this.state.originX + tempX;\n        resultY = _this.state.originY + tempY >= 100 ? 100 : _this.state.originY + tempY;\n      }\n\n      if (e.pageX - startX < 0 && e.pageY - startY > 0) {\n        resultX = _this.state.originX + tempX >= 100 ? 100 : _this.state.originX + tempX;\n        resultY = _this.state.originY - tempY <= 0 ? 0 : _this.state.originY - tempY;\n      }\n\n      if (e.pageX - startX > 0 && e.pageY - startY < 0) {\n        resultX = _this.state.originX - tempX <= 0 ? 0 : _this.state.originX - tempX;\n        resultY = _this.state.originY + tempY >= 100 ? 100 : _this.state.originY + tempY;\n      }\n\n      _this.refs['box-scale'].style.transformOrigin = \"\".concat(resultX, \"% \").concat(resultY, \"%\");\n    };\n\n    return _this;\n  }\n\n  _createClass(SpeakerTrack, [{\n    key: \"render\",\n    value: function render() {\n      var _conferenceState$myIn,\n          _jitsiStore$speaker,\n          _this2 = this;\n\n      var _this$props = this.props,\n          jitsiStore = _this$props.jitsiStore,\n          conferenceState = _this$props.conferenceState;\n      var profiles = conferenceState === null || conferenceState === void 0 ? void 0 : (_conferenceState$myIn = conferenceState.myInfo) === null || _conferenceState$myIn === void 0 ? void 0 : _conferenceState$myIn.profiles;\n      var isBot = isBotRecord(profiles);\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"speaker-video\",\n        style: {\n          cursor: jitsiStore.speaker ? 'pointer' : 'initial'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 7\n        }\n      }, !isBot && ((_jitsiStore$speaker = jitsiStore.speaker) === null || _jitsiStore$speaker === void 0 ? void 0 : _jitsiStore$speaker.track.videoType) === 'desktop' && /*#__PURE__*/React.createElement(Annotate, {\n        zoomIndex: this.state.zoomIndex,\n        handleZoomIn: this.handleZoomIn,\n        handleZoomOut: this.handleZoomOut,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 11\n        }\n      }), jitsiStore.speaker ? /*#__PURE__*/React.createElement(\"div\", {\n        className: \"box-scale\",\n        ref: \"box-scale\",\n        style: {\n          transform: \"scale(\".concat(this.state.zoomIndex.toFixed(1), \")\"),\n          transformOrigin: '50% 50%'\n        },\n        onMouseDown: this.handleMouseDown,\n        onMouseUp: this.handleMouseUp,\n        onMouseMove: function onMouseMove(e) {\n          if (_this2.state.isMouseDown && _this2.state.zoomIndex > 1) {\n            _this2.handleMouseMove(e);\n          }\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Video, {\n        id: jitsiStore.speaker.track.getId(),\n        videoTrack: jitsiStore.speaker.track,\n        otherProps: {\n          onDoubleClick: function onDoubleClick(e) {\n            e.target.requestFullscreen();\n          }\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 13\n        }\n      })) : /*#__PURE__*/React.createElement(\"video\", {\n        style: {\n          transform: 'scale(0.5)'\n        },\n        poster: iconNoAvatar,\n        width: \"100%\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 13\n        }\n      }));\n    }\n  }]);\n\n  return SpeakerTrack;\n}(React.PureComponent), _temp)) || _class) || _class);\nexport default SpeakerTrack;","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/conference2/jitsi/SpeakerTrack.jsx"],"names":["React","inject","observer","Video","Annotate","isBotRecord","SpeakerTrack","stores","state","zoomIndex","isMouseDown","startX","startY","originX","originY","handleZoomOut","refs","style","transformOrigin","setState","_preState","handleZoomIn","handleMouseDown","e","persist","split","cursor","pageX","pageY","handleMouseUp","handleMouseMove","scaleX","currentTarget","offsetWidth","scaleY","offsetHeight","currentOriginX","currentOriginY","tempX","Math","abs","tempY","resultX","resultY","props","jitsiStore","conferenceState","profiles","myInfo","isBot","speaker","track","videoType","transform","toFixed","getId","onDoubleClick","target","requestFullscreen","iconNoAvatar","PureComponent"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { inject, observer } from 'mobx-react'\n\nimport { Video } from './media'\nimport Annotate from './components/Annotate'\n\nimport iconNoAvatar from '@misc/images/no-avatar.svg'\nimport { isBotRecord } from '@utils'\n\n@inject(({ stores }) => stores)\n@observer\nclass SpeakerTrack extends React.PureComponent {\n  state = {\n    zoomIndex: 1,\n    isMouseDown: false,\n    startX: 0,\n    startY: 0,\n    originX: 50,\n    originY: 50\n  }\n\n  handleZoomOut = () => {\n    if (this.state.zoomIndex === 1.2) {\n      this.refs['box-scale'].style.transformOrigin = `50% 50%`\n    }\n\n    this.setState(_preState => ({\n      ..._preState,\n      zoomIndex: _preState.zoomIndex - 0.2\n    }))\n  }\n\n  handleZoomIn = () => {\n    this.setState(_preState => ({\n      ..._preState,\n      zoomIndex: _preState.zoomIndex + 0.2\n    }))\n  }\n\n  handleMouseDown = e => {\n    e.persist()\n    const originX = +this.refs['box-scale'].style.transformOrigin.split(' ')[0].split('%')[0]\n    const originY = +this.refs['box-scale'].style.transformOrigin.split(' ')[1].split('%')[0]\n    this.refs['box-scale'].style.cursor = 'move'\n\n    this.setState(_preState => ({\n      ..._preState,\n      isMouseDown: true,\n      startX: e.pageX,\n      startY: e.pageY,\n      originX,\n      originY\n    }))\n  }\n\n  handleMouseUp = () => {\n    const originX = +this.refs['box-scale'].style.transformOrigin.split(' ')[0].split('%')[0]\n    const originY = +this.refs['box-scale'].style.transformOrigin.split(' ')[1].split('%')[0]\n    this.refs['box-scale'].style.cursor = 'pointer'\n\n    this.setState(_preState => ({\n      ..._preState,\n      isMouseDown: false,\n      startX: 0,\n      startY: 0,\n      originX,\n      originY\n    }))\n  }\n\n  handleMouseMove = e => {\n    e.persist()\n    const { startX, startY } = this.state\n    const scaleX = e.currentTarget.offsetWidth * (this.state.zoomIndex - 1)\n    const scaleY = e.currentTarget.offsetHeight * (this.state.zoomIndex - 1)\n    const currentOriginX = +this.refs['box-scale'].style.transformOrigin.split(' ')[0].split('%')[0]\n    const currentOriginY = +this.refs['box-scale'].style.transformOrigin.split(' ')[1].split('%')[0]\n    const tempX = (Math.abs(e.pageX - startX) / scaleX) * 100\n    const tempY = (Math.abs(e.pageY - startY) / scaleY) * 100\n    let resultX = currentOriginX\n    let resultY = currentOriginY\n\n    if (e.pageX - startX > 0 && e.pageY - startY > 0) {\n      resultX = this.state.originX - tempX <= 0 ? 0 : this.state.originX - tempX\n      resultY = this.state.originY - tempY <= 0 ? 0 : this.state.originY - tempY\n    }\n\n    if (e.pageX - startX < 0 && e.pageY - startY < 0) {\n      resultX = this.state.originX + tempX >= 100 ? 100 : this.state.originX + tempX\n      resultY = this.state.originY + tempY >= 100 ? 100 : this.state.originY + tempY\n    }\n\n    if (e.pageX - startX < 0 && e.pageY - startY > 0) {\n      resultX = this.state.originX + tempX >= 100 ? 100 : this.state.originX + tempX\n      resultY = this.state.originY - tempY <= 0 ? 0 : this.state.originY - tempY\n    }\n\n    if (e.pageX - startX > 0 && e.pageY - startY < 0) {\n      resultX = this.state.originX - tempX <= 0 ? 0 : this.state.originX - tempX\n      resultY = this.state.originY + tempY >= 100 ? 100 : this.state.originY + tempY\n    }\n\n    this.refs['box-scale'].style.transformOrigin = `${resultX}% ${resultY}%`\n  }\n\n  render() {\n    const { jitsiStore, conferenceState } = this.props\n    const profiles = conferenceState?.myInfo?.profiles\n    const isBot = isBotRecord(profiles)\n    return (\n      <div className='speaker-video' style={{ cursor: jitsiStore.speaker ? 'pointer' : 'initial' }}>\n        {!isBot && jitsiStore.speaker?.track.videoType === 'desktop' && (\n          <Annotate\n            zoomIndex={this.state.zoomIndex}\n            handleZoomIn={this.handleZoomIn}\n            handleZoomOut={this.handleZoomOut}\n          />\n        )}\n\n        {jitsiStore.speaker ? (\n          <div\n            className='box-scale'\n            ref='box-scale'\n            style={{\n              transform: `scale(${this.state.zoomIndex.toFixed(1)})`,\n              transformOrigin: '50% 50%'\n            }}\n            onMouseDown={this.handleMouseDown}\n            onMouseUp={this.handleMouseUp}\n            onMouseMove={e => {\n              if (this.state.isMouseDown && this.state.zoomIndex > 1) {\n                this.handleMouseMove(e)\n              }\n            }}\n          >\n            <Video\n              id={jitsiStore.speaker.track.getId()}\n              videoTrack={jitsiStore.speaker.track}\n              otherProps={{\n                onDoubleClick: e => {\n                  e.target.requestFullscreen()\n                }\n              }}\n            />\n          </div>\n        ) : (\n            <video style={{ transform: 'scale(0.5)' }} poster={iconNoAvatar} width='100%' />\n          )}\n      </div>\n    )\n  }\n}\n\nexport default SpeakerTrack\n"]},"metadata":{},"sourceType":"module"}