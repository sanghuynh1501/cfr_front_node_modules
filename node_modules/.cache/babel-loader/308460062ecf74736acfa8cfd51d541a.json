{"ast":null,"code":"import \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport _objectSpread from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport \"antd/es/select/style\";\nimport _Select from \"antd/es/select\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/dashboard/groups2/index.jsx\";\n\nimport React, { Component } from 'react';\nimport { withTranslation } from 'react-i18next';\nimport { inject, observer } from 'mobx-react';\nimport moment from 'moment';\nimport debounce from 'lodash/debounce';\nimport ModalDelete from '../components/ModalDelete';\nimport ModalCreateNode from './components/ModalCreateNode';\nimport client, { M_DELETE_NODE, Q_NODES } from '@graphql';\nimport { newNotification, returnError, parseError, isSupperAdmin, hasPermissionInNode, hasPermission } from '@utils';\nimport { PER } from '@constants';\nimport { withRouter } from 'react-router-dom';\nimport './index.less';\nvar Search = _Input.Search;\nvar Option = _Select.Option;\nvar Group = (_dec = inject(function (_ref) {\n  var stores = _ref.stores;\n  return stores;\n}), withRouter(_class = _dec(_class = observer(_class = (_temp = /*#__PURE__*/function (_Component) {\n  _inherits(Group, _Component);\n\n  var _super = _createSuper(Group);\n\n  function Group(props) {\n    var _this;\n\n    _classCallCheck(this, Group);\n\n    _this = _super.call(this, props);\n    _this.columnBtnHolder = void 0;\n\n    _this.queryNodes = function (inputSearch) {\n      client.query({\n        query: Q_NODES,\n        fetchPolicy: 'network-only',\n        variables: {\n          inputSearch: inputSearch\n        }\n      }).then(function (_ref2) {\n        var nodes = _ref2.data.nodes;\n\n        _this.setState({\n          nodes: nodes\n        });\n      }).catch(function (error) {\n        return returnError('Get groups', {\n          error: error,\n          errorMessage: _this.props.i18n.t('notification.queryGroupError')\n        }, {\n          container: 'top-right'\n        });\n      });\n    };\n\n    _this.handleSelectFilter = function (value) {\n      _this.setState(function (prevState) {\n        return {\n          inputSearch: _objectSpread({}, prevState.inputSearch, {\n            view: value\n          })\n        };\n      }, function () {\n        _this.queryNodes(_this.state.inputSearch);\n      });\n    };\n\n    _this.handleSelectItem = function (_ref3) {\n      var name = _ref3.name,\n          _id = _ref3._id;\n\n      _this.props.history.push(\"/groupDetail/\".concat(_id));\n    };\n\n    _this.handleChangeSearch = function (e) {\n      var value = e.target.value;\n\n      _this.setState(function (prevState) {\n        return {\n          inputSearch: _objectSpread({}, prevState.inputSearch, {\n            text: value\n          })\n        };\n      });\n    };\n\n    _this.handleDeleteNode = function (nodeId) {\n      var _assertThisInitialize = _assertThisInitialized(_this),\n          queryNodes = _assertThisInitialize.queryNodes;\n\n      client.mutate({\n        mutation: M_DELETE_NODE,\n        fetchPolicy: 'no-cache',\n        variables: {\n          nodeId: nodeId\n        }\n      }).then(function (_ref4) {\n        var data = _ref4.data;\n\n        if (!data.deleteNode) {\n          throw new Error('notification.deleteGroupError');\n        }\n\n        newNotification(_this.props.i18n.t('notification.deleteGroupSuccess'), 'success', {\n          container: 'top-right'\n        });\n        queryNodes();\n      }).catch(function (error) {\n        return returnError('deleteNode', {\n          error: error,\n          errorMessage: _this.props.i18n.t(parseError(error))\n        }, {\n          container: 'top-right'\n        });\n      });\n    };\n\n    _this.handleSubmitSearch = function () {\n      _this.queryNodes(_this.state.inputSearch);\n    };\n\n    _this.state = {\n      filterKeys: '',\n      nodes: [],\n      inputSearch: null\n    };\n    _this.handleSubmitSearch = debounce(_this.handleSubmitSearch, 200);\n    return _this;\n  }\n\n  _createClass(Group, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.queryNodes();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          i18n = _this$props.i18n,\n          myInfo = _this$props.globalState.myInfo,\n          nodes = this.state.nodes;\n      var profiles = myInfo === null || myInfo === void 0 ? void 0 : myInfo.profiles;\n      var isAllowCreateNode = isSupperAdmin(profiles) || hasPermission(profiles, PER.P_NODE_CREATE);\n      var rowData = nodes.map(function (e) {\n        var _e$users;\n\n        return {\n          key: e._id,\n          _id: e._id,\n          name: /*#__PURE__*/React.createElement(\"span\", {\n            className: \"clickableSpan\",\n            onClick: function onClick() {\n              return _this2.handleSelectItem(e);\n            },\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 13\n            }\n          }, e.name),\n          descriptions: e.descriptions,\n          numberOfMember: e === null || e === void 0 ? void 0 : (_e$users = e.users) === null || _e$users === void 0 ? void 0 : _e$users.length,\n          createdAt: e.createdAt,\n          // lastModified: moment(e.lastModified).format('MMM Do YYYY, hh:mm a'),\n          owner: e.createdBy._id\n        };\n      }).filter(function (e) {\n        return e.name.props.children.toLowerCase().substring(0, _this2.state.filterKeys.length) === _this2.state.filterKeys;\n      });\n      var columns = [{\n        title: i18n.t('group.groupName'),\n        dataIndex: 'name',\n        sorter: function sorter(a, b) {\n          return a.name.props.children.localeCompare(b.name.props.children);\n        }\n      }, {\n        title: i18n.t('group.description'),\n        dataIndex: 'descriptions'\n      }, {\n        title: i18n.t('group.numberOfMember'),\n        dataIndex: 'numberOfMember'\n      }, {\n        title: i18n.t('createdAt'),\n        dataIndex: 'createdAt',\n        sorter: function sorter(a, b) {\n          return a.createdAt - b.createdAt;\n        },\n        render: function render(time) {\n          return moment(time).format('MMM Do YYYY, hh:mm a');\n        }\n      }, {\n        title: '',\n        key: 'x',\n        render: function render(_, node) {\n          var profileNode = profiles.find(function (profile) {\n            var _profile$node;\n\n            return (profile === null || profile === void 0 ? void 0 : (_profile$node = profile.node) === null || _profile$node === void 0 ? void 0 : _profile$node._id) === node._id;\n          });\n          return /*#__PURE__*/React.createElement(\"span\", {\n            className: \"columnBtnHolder\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 13\n            }\n          }, isSupperAdmin(profiles) || hasPermissionInNode(profileNode, PER.P_NODE_REMOVE) ? /*#__PURE__*/React.createElement(ModalDelete, {\n            itemToDelete: node,\n            title: i18n.t('group.deleteGroup'),\n            handleDeleteItem: _this2.handleDeleteNode,\n            textButtonDelete: i18n.t('common.delete'),\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 17\n            }\n          }) : '');\n        }\n      }];\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"wrapper-default-group\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        style: {\n          color: '#313942',\n          marginBottom: '10px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 9\n        }\n      }, i18n.t('group.groupManagement')), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"wrapper-search-create\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"wrapper-search\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Search, {\n        style: {\n          width: 220,\n          marginRight: 10\n        },\n        className: \"search\",\n        onChange: this.handleChangeSearch,\n        placeholder: i18n.t('search.textSearch'),\n        onSearch: this.handleSubmitSearch,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 13\n        }\n      }), /*#__PURE__*/React.createElement(_Select, {\n        style: {\n          width: 148\n        },\n        placeholder: i18n.t('common.filter'),\n        onSelect: this.handleSelectFilter,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Option, {\n        value: \"ALL\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 15\n        }\n      }, \"All\"), /*#__PURE__*/React.createElement(Option, {\n        value: \"MANAGED_BY_ME\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 15\n        }\n      }, i18n.t('group.managedByMe')), /*#__PURE__*/React.createElement(Option, {\n        value: \"I_JOINED\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 15\n        }\n      }, i18n.t('group.i_joined')))), isAllowCreateNode && /*#__PURE__*/React.createElement(ModalCreateNode, {\n        queryNodes: this.queryNodes,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(_Table, {\n        className: \"common-table group-table\",\n        dataSource: rowData,\n        columns: columns,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 9\n        }\n      }));\n    }\n  }]);\n\n  return Group;\n}(Component), _temp)) || _class) || _class) || _class);\nexport default withTranslation()(Group);","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/dashboard/groups2/index.jsx"],"names":["React","Component","withTranslation","inject","observer","moment","debounce","ModalDelete","ModalCreateNode","client","M_DELETE_NODE","Q_NODES","newNotification","returnError","parseError","isSupperAdmin","hasPermissionInNode","hasPermission","PER","withRouter","Search","Option","Group","stores","props","columnBtnHolder","queryNodes","inputSearch","query","fetchPolicy","variables","then","nodes","data","setState","catch","error","errorMessage","i18n","t","container","handleSelectFilter","value","prevState","view","state","handleSelectItem","name","_id","history","push","handleChangeSearch","e","target","text","handleDeleteNode","nodeId","mutate","mutation","deleteNode","Error","handleSubmitSearch","filterKeys","myInfo","globalState","profiles","isAllowCreateNode","P_NODE_CREATE","rowData","map","key","descriptions","numberOfMember","users","length","createdAt","owner","createdBy","filter","children","toLowerCase","substring","columns","title","dataIndex","sorter","a","b","localeCompare","render","time","format","_","node","profileNode","find","profile","P_NODE_REMOVE","color","marginBottom","width","marginRight"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Input, Table, Select } from 'antd'\nimport { withTranslation } from 'react-i18next'\nimport { inject, observer } from 'mobx-react'\nimport moment from 'moment'\nimport debounce from 'lodash/debounce'\nimport ModalDelete from '../components/ModalDelete'\nimport ModalCreateNode from './components/ModalCreateNode'\nimport client, { M_DELETE_NODE, Q_NODES } from '@graphql'\nimport { newNotification, returnError, parseError, isSupperAdmin, hasPermissionInNode, hasPermission } from '@utils'\nimport { PER } from '@constants'\nimport { withRouter } from 'react-router-dom'\nimport './index.less'\n\nconst { Search } = Input\nconst { Option } = Select\n\n@withRouter\n@inject(({ stores }) => stores)\n@observer\nclass Group extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      filterKeys: '',\n      nodes: [],\n      inputSearch: null\n    }\n    this.handleSubmitSearch = debounce(this.handleSubmitSearch, 200)\n  }\n\n  componentDidMount() {\n    this.queryNodes()\n  }\n  columnBtnHolder\n\n  queryNodes = (inputSearch) => {\n    client\n      .query({\n        query: Q_NODES,\n        fetchPolicy: 'network-only',\n        variables: {\n          inputSearch\n        }\n      })\n      .then(({ data: { nodes } }) => {\n        this.setState({ nodes })\n      })\n      .catch(error =>\n        returnError(\n          'Get groups',\n          {\n            error,\n            errorMessage: this.props.i18n.t('notification.queryGroupError')\n          },\n          { container: 'top-right' }\n        )\n      )\n  }\n\n  handleSelectFilter = value => {\n    this.setState(prevState => ({\n      inputSearch: {\n        ...prevState.inputSearch,\n        view: value\n      }\n    }), () => {\n      this.queryNodes(this.state.inputSearch)\n    })\n  }\n\n\n  handleSelectItem = ({ name, _id }) => {\n    this.props.history.push(`/groupDetail/${_id}`)\n  }\n\n\n  handleChangeSearch = e => {\n    const {\n      target: { value }\n    } = e\n    this.setState(prevState => ({\n      inputSearch: {\n        ...prevState.inputSearch,\n        text: value\n      }\n    }))\n  }\n\n  handleDeleteNode = nodeId => {\n    const { queryNodes } = this\n    client\n      .mutate({\n        mutation: M_DELETE_NODE,\n        fetchPolicy: 'no-cache',\n        variables: {\n          nodeId\n        }\n      })\n      .then(({ data }) => {\n        if (!data.deleteNode) {\n          throw new Error('notification.deleteGroupError')\n        }\n        newNotification(this.props.i18n.t('notification.deleteGroupSuccess'), 'success', { container: 'top-right' })\n        queryNodes()\n      })\n      .catch(error =>\n        returnError(\n          'deleteNode',\n          { error, errorMessage: this.props.i18n.t(parseError(error)) },\n          { container: 'top-right' }\n        )\n      )\n  }\n\n  handleSubmitSearch = () => {\n    this.queryNodes(this.state.inputSearch)\n  }\n\n\n  render() {\n    const {\n      props: { i18n,\n        globalState: {\n          myInfo\n        }\n      },\n      state: { nodes }\n    } = this\n\n    const profiles = myInfo?.profiles\n    const isAllowCreateNode = isSupperAdmin(profiles) || hasPermission(profiles, PER.P_NODE_CREATE)\n\n\n    const rowData = nodes\n      .map(e => {\n        return {\n          key: e._id,\n          _id: e._id,\n          name: (\n            <span\n              className='clickableSpan'\n              onClick={() => this.handleSelectItem(e)}\n            >\n              {e.name}\n            </span>\n          ),\n          descriptions: e.descriptions,\n          numberOfMember: e?.users?.length,\n          createdAt: e.createdAt,\n          // lastModified: moment(e.lastModified).format('MMM Do YYYY, hh:mm a'),\n          owner: e.createdBy._id\n        }\n      })\n      .filter(\n        e =>\n          e.name.props.children\n            .toLowerCase()\n            .substring(0, this.state.filterKeys.length) ===\n          this.state.filterKeys\n      )\n\n    const columns = [\n      {\n        title: i18n.t('group.groupName'),\n        dataIndex: 'name',\n        sorter: (a, b) =>\n          a.name.props.children.localeCompare(b.name.props.children)\n      },\n      {\n        title: i18n.t('group.description'),\n        dataIndex: 'descriptions'\n      },\n      {\n        title: i18n.t('group.numberOfMember'),\n        dataIndex: 'numberOfMember'\n      },\n      {\n        title: i18n.t('createdAt'),\n        dataIndex: 'createdAt',\n        sorter: (a, b) => a.createdAt - b.createdAt,\n        render: time => moment(time).format('MMM Do YYYY, hh:mm a'),\n      },\n      {\n        title: '',\n        key: 'x',\n        render: (_, node) => {\n          const profileNode = profiles.find(profile => profile?.node?._id === node._id)\n          return (\n            <span className='columnBtnHolder'>\n              {isSupperAdmin(profiles) || hasPermissionInNode(profileNode, PER.P_NODE_REMOVE) ? (\n                <ModalDelete\n                  itemToDelete={node}\n                  title={i18n.t('group.deleteGroup')}\n                  handleDeleteItem={this.handleDeleteNode}\n                  textButtonDelete={i18n.t('common.delete')}\n                />\n              ) : ''}\n            </span>\n          )\n        }\n      }\n    ]\n\n\n    return (\n      <div className='wrapper-default-group'>\n        <p style={{ color: '#313942', marginBottom: '10px' }}>\n          {i18n.t('group.groupManagement')}\n        </p>\n        <div className='wrapper-search-create'>\n          <div className='wrapper-search'>\n            <Search\n              style={{ width: 220, marginRight: 10 }}\n              className='search'\n              onChange={this.handleChangeSearch}\n              placeholder={i18n.t('search.textSearch')}\n              onSearch={this.handleSubmitSearch}\n            />\n\n            <Select\n              style={{ width: 148 }}\n              placeholder={i18n.t('common.filter')}\n              onSelect={this.handleSelectFilter}\n            >\n              <Option value='ALL'>All</Option>\n              <Option value='MANAGED_BY_ME'>{i18n.t('group.managedByMe')}</Option>\n              <Option value='I_JOINED'>{i18n.t('group.i_joined')}</Option>\n            </Select>\n          </div>\n\n          {isAllowCreateNode && (\n            <ModalCreateNode queryNodes={this.queryNodes} />\n          )}\n\n        </div>\n        <Table\n          className='common-table group-table'\n          dataSource={rowData}\n          columns={columns}\n        />\n      </div>\n    )\n  }\n}\n\nexport default withTranslation()(Group)\n"]},"metadata":{},"sourceType":"module"}