{"ast":null,"code":"import _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/dashboard/userDetail/index.jsx\";\n\nimport React from 'react';\nimport { withRouter } from 'react-router';\nimport { inject, observer } from 'mobx-react';\nimport { withTranslation } from 'react-i18next';\nimport { returnError, newNotification, isSupperAdmin, hasPermission } from '@utils';\nimport client, { Q_USER, M_DELETE_USERS } from '@graphql';\nimport UserInfo from './DetailUser';\nimport FormCreateUser from './CreateUser';\nimport { PER } from '@constants';\nvar UserDetail = (_dec = inject(function (_ref) {\n  var stores = _ref.stores;\n  return stores;\n}), withRouter(_class = _dec(_class = observer(_class = (_temp = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(UserDetail, _React$PureComponent);\n\n  var _super = _createSuper(UserDetail);\n\n  function UserDetail(props) {\n    var _this;\n\n    _classCallCheck(this, UserDetail);\n\n    _this = _super.call(this, props);\n\n    _this.backToDefault = function () {\n      _this.props.history.push('/users');\n    };\n\n    _this._queryInfoUser = function () {\n      client.query({\n        query: Q_USER,\n        variables: {\n          userId: _this.props.match.params.ID\n        },\n        fetchPolicy: 'network-only'\n      }).then(function (_ref2) {\n        var user = _ref2.data.user;\n\n        if (user) {\n          return _this.setState({\n            user: user\n          });\n        }\n\n        return _this.props.history.push('/users');\n      }).catch(function (error) {\n        _this.props.history.push('/users');\n\n        return returnError('users', {\n          error: error,\n          errorMessage: _this.props.i18n.t('notification.queryUserError')\n        }, {\n          container: 'top-right'\n        });\n      });\n    };\n\n    _this._mutationDeleteUsers = function (_id) {\n      client.mutate({\n        mutation: M_DELETE_USERS,\n        variables: {\n          userIds: [_id]\n        }\n      }).then(function (_ref3) {\n        var deleteUser = _ref3.data.deleteUser;\n\n        if (deleteUser) {\n          _this._queryInfoUser();\n\n          _this.props.history.push('/users');\n\n          return newNotification(_this.props.i18n.t('notification.deleteUserSuccess'), 'success');\n        }\n      }).catch(function (error) {\n        return returnError('deleteUsers', {\n          error: error,\n          errorMessage: _this.props.i18n.t('notification.deleteUserError')\n        }, {\n          container: 'top-right'\n        });\n      });\n    };\n\n    _this.state = {\n      user: {},\n      createUser: false\n    };\n    return _this;\n  }\n\n  _createClass(UserDetail, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _globalState$myInfo;\n\n      var _this$props = this.props,\n          globalState = _this$props.globalState,\n          history = _this$props.history;\n      var profiles = globalState === null || globalState === void 0 ? void 0 : (_globalState$myInfo = globalState.myInfo) === null || _globalState$myInfo === void 0 ? void 0 : _globalState$myInfo.profiles;\n\n      if (profiles) {\n        var isSAdmin = isSupperAdmin(profiles);\n        var isAllowCreateUser = isSAdmin || hasPermission(profiles, PER.P_USER_CREATE);\n        var isAllowViewUser = isSAdmin || hasPermission(profiles, PER.P_USER_VIEW);\n        var isAllowEditUser = isSAdmin || hasPermission(profiles, PER.P_USER_EDIT);\n\n        if (!isSAdmin && !isAllowCreateUser && !isAllowViewUser && !isAllowEditUser) {\n          history.push('/');\n        }\n      }\n\n      if (this.props.match.params.ID === 'new') {\n        return this.setState({\n          createUser: true\n        });\n      }\n\n      this._queryInfoUser();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _globalState$myInfo2;\n\n      var globalState = this.props.globalState;\n      var profiles = globalState === null || globalState === void 0 ? void 0 : (_globalState$myInfo2 = globalState.myInfo) === null || _globalState$myInfo2 === void 0 ? void 0 : _globalState$myInfo2.profiles;\n      var isAllowEditUser = isSupperAdmin(profiles) || hasPermission(profiles, PER.P_USER_EDIT);\n      return this.state.createUser ? /*#__PURE__*/React.createElement(FormCreateUser, {\n        backToDefault: this.backToDefault,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 7\n        }\n      }) : this.state.user ? /*#__PURE__*/React.createElement(UserInfo, {\n        isAllowEditUser: isAllowEditUser,\n        queryInfoUser: this._queryInfoUser,\n        user: this.state.user,\n        mutationDeleteUsers: this._mutationDeleteUsers,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 7\n        }\n      }) : /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }\n      });\n    }\n  }]);\n\n  return UserDetail;\n}(React.PureComponent), _temp)) || _class) || _class) || _class);\nexport default withTranslation()(UserDetail);","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/dashboard/userDetail/index.jsx"],"names":["React","withRouter","inject","observer","withTranslation","returnError","newNotification","isSupperAdmin","hasPermission","client","Q_USER","M_DELETE_USERS","UserInfo","FormCreateUser","PER","UserDetail","stores","props","backToDefault","history","push","_queryInfoUser","query","variables","userId","match","params","ID","fetchPolicy","then","user","data","setState","catch","error","errorMessage","i18n","t","container","_mutationDeleteUsers","_id","mutate","mutation","userIds","deleteUser","state","createUser","globalState","profiles","myInfo","isSAdmin","isAllowCreateUser","P_USER_CREATE","isAllowViewUser","P_USER_VIEW","isAllowEditUser","P_USER_EDIT","PureComponent"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { withRouter } from 'react-router'\nimport { inject, observer } from 'mobx-react'\nimport { withTranslation } from 'react-i18next'\n\nimport { returnError, newNotification, isSupperAdmin, hasPermission } from '@utils'\nimport client, { Q_USER, M_DELETE_USERS } from '@graphql'\n\nimport UserInfo from './DetailUser'\nimport FormCreateUser from './CreateUser'\nimport { PER } from '@constants'\n\n@withRouter\n@inject(({ stores }) => stores)\n@observer\nclass UserDetail extends React.PureComponent {\n  constructor(props) {\n    super(props)\n    this.state = {\n      user: {},\n      createUser: false\n    }\n  }\n\n  componentDidMount() {\n    const {\n      globalState,\n      history\n    } = this.props\n\n    const profiles = globalState?.myInfo?.profiles\n\n    if (profiles) {\n      const isSAdmin = isSupperAdmin(profiles)\n      const isAllowCreateUser = isSAdmin || hasPermission(profiles, PER.P_USER_CREATE)\n      const isAllowViewUser = isSAdmin || hasPermission(profiles, PER.P_USER_VIEW)\n      const isAllowEditUser = isSAdmin || hasPermission(profiles, PER.P_USER_EDIT)\n\n      if (!isSAdmin &&\n        !isAllowCreateUser &&\n        !isAllowViewUser &&\n        !isAllowEditUser) {\n        history.push('/')\n      }\n    }\n\n    if (this.props.match.params.ID === 'new') {\n      return this.setState({ createUser: true })\n    }\n\n    this._queryInfoUser()\n  }\n\n  backToDefault = () => {\n    this.props.history.push('/users')\n  }\n\n  _queryInfoUser = () => {\n    client\n      .query({\n        query: Q_USER,\n        variables: {\n          userId: this.props.match.params.ID\n        },\n        fetchPolicy: 'network-only'\n      })\n      .then(({ data: { user } }) => {\n        if (user) {\n          return this.setState({ user })\n        }\n        return this.props.history.push('/users')\n      })\n      .catch(error => {\n        this.props.history.push('/users')\n        return returnError(\n          'users',\n          { error, errorMessage: this.props.i18n.t('notification.queryUserError') },\n          { container: 'top-right' }\n        )\n      })\n  }\n\n  _mutationDeleteUsers = _id => {\n    client\n      .mutate({\n        mutation: M_DELETE_USERS,\n        variables: {\n          userIds: [_id]\n        }\n      })\n      .then(({ data: { deleteUser } }) => {\n        if (deleteUser) {\n          this._queryInfoUser()\n          this.props.history.push('/users')\n          return newNotification(this.props.i18n.t('notification.deleteUserSuccess'), 'success')\n        }\n      })\n      .catch(error =>\n        returnError(\n          'deleteUsers',\n          { error, errorMessage: this.props.i18n.t('notification.deleteUserError') },\n          { container: 'top-right' }\n        )\n      )\n  }\n\n  render() {\n    const {\n      globalState\n    } = this.props\n\n    const profiles = globalState?.myInfo?.profiles\n    const isAllowEditUser = isSupperAdmin(profiles) || hasPermission(profiles, PER.P_USER_EDIT)\n\n    return this.state.createUser ? (\n      <FormCreateUser backToDefault={this.backToDefault} />\n    ) : this.state.user ? (\n      <UserInfo\n        isAllowEditUser={isAllowEditUser}\n        queryInfoUser={this._queryInfoUser}\n        user={this.state.user}\n        mutationDeleteUsers={this._mutationDeleteUsers}\n      />\n    ) : (\n          <React.Fragment />\n        )\n  }\n}\n\nexport default withTranslation()(UserDetail)\n"]},"metadata":{},"sourceType":"module"}