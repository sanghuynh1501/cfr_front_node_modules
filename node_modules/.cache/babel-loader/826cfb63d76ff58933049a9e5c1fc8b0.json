{"ast":null,"code":"import _defineProperty from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/dashboard/report/index.js\";\n\nimport React from 'react';\nimport { Calendar, Views, momentLocalizer } from 'react-big-calendar';\nimport { withTranslation } from 'react-i18next';\nimport moment from 'moment';\nimport './index.less';\nimport { client, Q_CONFERENCES } from '@graphql';\nimport { returnError, isSupperAdmin, hasPermission } from '@utils';\nimport { _confType, PER } from '@constants';\nimport { inject, observer } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nvar localizer = momentLocalizer(moment);\nvar allViews = Object.keys(Views).map(function (k) {\n  return Views[k];\n});\n\nvar ColoredDateCellWrapper = function ColoredDateCellWrapper(_ref) {\n  var children = _ref.children;\n  return React.cloneElement(React.Children.only(children), {\n    style: {\n      backgroundColor: '#FFF'\n    }\n  });\n};\n\nvar Report = (_dec = inject(function (_ref2) {\n  var stores = _ref2.stores;\n  return stores;\n}), withRouter(_class = _dec(_class = observer(_class = (_temp = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(Report, _React$PureComponent);\n\n  var _super = _createSuper(Report);\n\n  function Report() {\n    var _this$state;\n\n    var _this;\n\n    _classCallCheck(this, Report);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = (_this$state = {}, _defineProperty(_this$state, _confType.PREVIOUS, []), _defineProperty(_this$state, _confType.ONGOING, []), _defineProperty(_this$state, _confType.UPCOMING, []), _this$state);\n\n    _this.queryConferences = function (type, filter) {\n      client.query({\n        query: Q_CONFERENCES,\n        variables: {\n          type: type,\n          filter: filter\n        },\n        fetchPolicy: 'network-only'\n      }).then(function (_ref3) {\n        var conferences = _ref3.data.conferences;\n\n        _this.setState(_defineProperty({}, type, conferences));\n      }).catch(function (error) {\n        return returnError('Get conferences', {\n          error: error,\n          errorMessage: _this.props.i18n.t('notification.queryConferenceError')\n        }, {\n          container: 'top-right'\n        });\n      });\n    };\n\n    _this.convertData = function () {\n      var data = _this.state[_confType.PREVIOUS];\n      var temp = data.concat(_this.state[_confType.ONGOING]).concat(_this.state[_confType.UPCOMING]);\n      return temp.map(function (item) {\n        return {\n          id: item._id,\n          title: item.name,\n          start: new Date(item.startAt),\n          end: new Date(item.startAt + item.duration)\n        };\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(Report, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this$props = this.props,\n          myInfo = _this$props.globalState.myInfo,\n          history = _this$props.history;\n      var profiles = myInfo === null || myInfo === void 0 ? void 0 : myInfo.profiles;\n      var isAllowViewReport = isSupperAdmin(profiles) || hasPermission(profiles, PER.P_REPORT_VIEW);\n\n      if (!isAllowViewReport) {\n        return history.push('/');\n      }\n\n      this.queryConferences(_confType.ONGOING);\n      this.queryConferences(_confType.UPCOMING);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var data = this.convertData();\n      return /*#__PURE__*/React.createElement(Calendar, {\n        events: data,\n        views: allViews,\n        step: 60,\n        localizer: localizer,\n        showMultiDayTimes: true,\n        defaultDate: new Date(),\n        components: {\n          timeSlotWrapper: ColoredDateCellWrapper\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return Report;\n}(React.PureComponent), _temp)) || _class) || _class) || _class);\nexport default withTranslation()(Report);","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/dashboard/report/index.js"],"names":["React","Calendar","Views","momentLocalizer","withTranslation","moment","client","Q_CONFERENCES","returnError","isSupperAdmin","hasPermission","_confType","PER","inject","observer","withRouter","localizer","allViews","Object","keys","map","k","ColoredDateCellWrapper","children","cloneElement","Children","only","style","backgroundColor","Report","stores","state","PREVIOUS","ONGOING","UPCOMING","queryConferences","type","filter","query","variables","fetchPolicy","then","conferences","data","setState","catch","error","errorMessage","props","i18n","t","container","convertData","temp","concat","item","id","_id","title","name","start","Date","startAt","end","duration","myInfo","globalState","history","profiles","isAllowViewReport","P_REPORT_VIEW","push","timeSlotWrapper","PureComponent"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Calendar, Views, momentLocalizer } from 'react-big-calendar'\nimport { withTranslation } from 'react-i18next'\nimport moment from 'moment'\nimport './index.less'\n\nimport { client, Q_CONFERENCES } from '@graphql'\nimport { returnError, isSupperAdmin, hasPermission } from '@utils'\nimport { _confType, PER } from '@constants'\nimport { inject, observer } from 'mobx-react'\nimport { withRouter } from 'react-router-dom'\n\nconst localizer = momentLocalizer(moment)\nlet allViews = Object.keys(Views).map(k => Views[k])\n\nconst ColoredDateCellWrapper = ({ children }) =>\n  React.cloneElement(React.Children.only(children), {\n    style: {\n      backgroundColor: '#FFF'\n    }\n  })\n\n@withRouter\n@inject(({ stores }) => stores)\n@observer\nclass Report extends React.PureComponent {\n  state = {\n    [_confType.PREVIOUS]: [],\n    [_confType.ONGOING]: [],\n    [_confType.UPCOMING]: []\n  }\n  queryConferences = (type, filter) => {\n    client\n      .query({\n        query: Q_CONFERENCES,\n        variables: { type, filter },\n        fetchPolicy: 'network-only'\n      })\n      .then(({ data: { conferences } }) => {\n        this.setState({ [type]: conferences })\n      })\n      .catch(error =>\n        returnError(\n          'Get conferences',\n          {\n            error,\n            errorMessage: this.props.i18n.t('notification.queryConferenceError')\n          },\n          { container: 'top-right' }\n        )\n      )\n  }\n\n  componentDidMount() {\n    const {\n      globalState: {\n        myInfo\n      },\n      history\n    } = this.props\n    const profiles = myInfo?.profiles\n    const isAllowViewReport = isSupperAdmin(profiles) || hasPermission(profiles, PER.P_REPORT_VIEW)\n    if (!isAllowViewReport) {\n      return history.push('/')\n    }\n\n    this.queryConferences(_confType.ONGOING)\n    this.queryConferences(_confType.UPCOMING)\n  }\n\n  convertData = () => {\n    const data = this.state[_confType.PREVIOUS]\n    const temp = data.concat(this.state[_confType.ONGOING]).concat(this.state[_confType.UPCOMING])\n    return temp.map(item => {\n      return {\n        id: item._id,\n        title: item.name,\n        start: new Date(item.startAt),\n        end: new Date(item.startAt + item.duration)\n      }\n    })\n  }\n\n  render() {\n    const data = this.convertData()\n    return (\n      <Calendar\n        events={data}\n        views={allViews}\n        step={60}\n        localizer={localizer}\n        showMultiDayTimes\n        defaultDate={new Date()}\n        components={{\n          timeSlotWrapper: ColoredDateCellWrapper\n        }}\n      />\n    )\n  }\n}\n\nexport default withTranslation()(Report)\n"]},"metadata":{},"sourceType":"module"}