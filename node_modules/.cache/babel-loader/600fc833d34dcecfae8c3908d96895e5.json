{"ast":null,"code":"import \"antd/es/breadcrumb/style\";\nimport _Breadcrumb from \"antd/es/breadcrumb\";\nimport _defineProperty from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/sang/js/cfr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport \"antd/es/tabs/style\";\nimport _Tabs from \"antd/es/tabs\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"/home/sang/js/cfr-frontend/src/pages/dashboard/conferences/index.jsx\";\n\nimport React, { Component } from 'react';\nimport { inject, observer } from 'mobx-react';\nimport { withTranslation } from 'react-i18next';\nimport { _confType, ROLE } from '@constants';\nimport Meeting from './Meeting';\nimport CreateConference from './CreateConference';\nimport { client, Q_CONFERENCES, M_DELETE_CONFERENCE } from '@graphql';\nimport { newNotification, returnError, isSupperAdmin } from '@utils';\nimport { withRouter } from 'react-router-dom';\nvar TabPane = _Tabs.TabPane;\nvar DISPLAY = {\n  DETAIL: 'DETAIL',\n  CREATE: 'CREATE',\n  DEFAULT: 'DEFAULT',\n  EDIT: 'EDIT'\n};\nvar ConferencesComponent = (_dec = inject(function (_ref) {\n  var stores = _ref.stores;\n  return stores;\n}), withRouter(_class = _dec(_class = observer(_class = (_temp = /*#__PURE__*/function (_Component) {\n  _inherits(ConferencesComponent, _Component);\n\n  var _super = _createSuper(ConferencesComponent);\n\n  function ConferencesComponent(props) {\n    var _this$state;\n\n    var _this;\n\n    _classCallCheck(this, ConferencesComponent);\n\n    _this = _super.call(this, props);\n\n    _this.handleDeleteItem = function (_id, type) {\n      client.mutate({\n        mutation: M_DELETE_CONFERENCE,\n        variables: {\n          conferenceId: _id\n        }\n      }).then(function (_ref2) {\n        var deleteConference = _ref2.data.deleteConference;\n\n        if (deleteConference) {\n          _this.queryConferences(type);\n\n          _this.backToDefault();\n\n          return newNotification(_this.props.i18n.t('notification.deleteMeetingSuccess'), 'success');\n        }\n      }).catch(function (error) {\n        return returnError('Delete Conference', {\n          error: error,\n          errorMessage: _this.props.i18n.t('notification.deleteMeetingError')\n        }, {\n          container: 'top-right'\n        });\n      });\n    };\n\n    _this.queryConferences = function (type, filter) {\n      client.query({\n        query: Q_CONFERENCES,\n        variables: {\n          type: type,\n          filter: filter\n        },\n        fetchPolicy: 'network-only'\n      }).then(function (_ref3) {\n        var conferences = _ref3.data.conferences;\n\n        _this.setState(_defineProperty({}, type, conferences));\n      }).catch(function (error) {\n        return returnError('Get conferences', {\n          error: error,\n          errorMessage: _this.props.i18n.t('notification.queryConferenceError')\n        }, {\n          container: 'top-right'\n        });\n      });\n    };\n\n    _this.componentDidMount = function () {\n      _this.queryConferences(_confType.PREVIOUS);\n\n      _this.queryConferences(_confType.ONGOING);\n\n      _this.queryConferences(_confType.UPCOMING);\n    };\n\n    _this.handleCreateConference = function () {\n      var newBreadCrumbPath = _this.state.breadcrumbPath;\n      newBreadCrumbPath.push('meeting.createMeeting');\n\n      _this.setState({\n        display: DISPLAY.CREATE,\n        breadcrumbPath: newBreadCrumbPath\n      });\n    };\n\n    _this.handleShowDetail = function (arg) {\n      _this.props.history.push(\"/conferenceDetail/\".concat(arg));\n    };\n\n    _this.backToDefault = function () {\n      _this.setState({\n        display: DISPLAY.DEFAULT,\n        breadcrumbPath: ['All Meetings'],\n        conferenceToShowDetail: ''\n      });\n    };\n\n    _this.handleJoinConference = function (e) {\n      window.open(\"\".concat(window.location.origin, \"/cfr/conference/\").concat(e));\n    };\n\n    _this.state = (_this$state = {\n      display: DISPLAY.DEFAULT,\n      conferences: [],\n      breadcrumbPath: ['All Meetings'],\n      conferenceToShowDetail: '',\n      conferenceSelected: null\n    }, _defineProperty(_this$state, _confType.PREVIOUS, []), _defineProperty(_this$state, _confType.ONGOING, []), _defineProperty(_this$state, _confType.UPCOMING, []), _this$state);\n    var url = new URL(window.location.href);\n    var isCreateConference = url.searchParams.get('createConference');\n\n    if (isCreateConference) {\n      setTimeout(function () {\n        _this.handleCreateConference();\n      }, 200);\n    }\n\n    return _this;\n  }\n\n  _createClass(ConferencesComponent, [{\n    key: \"render\",\n    value: function render() {\n      var _switchComponent,\n          _this2 = this;\n\n      var _this$state2 = this.state,\n          breadcrumbPath = _this$state2.breadcrumbPath,\n          display = _this$state2.display,\n          _this$props = this.props,\n          i18n = _this$props.i18n,\n          myInfo = _this$props.globalState.myInfo;\n      var profiles = myInfo === null || myInfo === void 0 ? void 0 : myInfo.profiles; //TODO: Upgrade check by Permission code\n\n      var filteredPrevConf = this.state[_confType.PREVIOUS].filter(function (conf) {\n        return conf.users.map(function (e) {\n          return e.user._id;\n        }).includes(myInfo._id) || conf.createdBy._id === myInfo._id || isSupperAdmin(profiles) || (profiles === null || profiles === void 0 ? void 0 : profiles.some(function (profile) {\n          var _profile$role;\n\n          return (profile === null || profile === void 0 ? void 0 : (_profile$role = profile.role) === null || _profile$role === void 0 ? void 0 : _profile$role.code) === ROLE.R_ADMIN;\n        }));\n      });\n\n      var switchComponent = (_switchComponent = {}, _defineProperty(_switchComponent, DISPLAY.CREATE, /*#__PURE__*/React.createElement(CreateConference, {\n        refetch: this.queryConferences,\n        handleShowDetail: this.handleShowDetail,\n        backToDefault: this.backToDefault,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 9\n        }\n      })), _defineProperty(_switchComponent, DISPLAY.DEFAULT, /*#__PURE__*/React.createElement(_Tabs, {\n        className: \"conferenceTabs\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(TabPane, {\n        tab: i18n.t('meeting.ongoingMeetings'),\n        key: \"1\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Meeting, {\n        conferences: this.state[_confType.ONGOING],\n        conferenceType: _confType.ONGOING,\n        handleDeleteItem: this.handleDeleteItem,\n        handleShowDetail: this.handleShowDetail,\n        handleCreateConference: this.handleCreateConference,\n        handleJoinConference: this.handleJoinConference,\n        refetch: this.queryConferences,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(TabPane, {\n        tab: i18n.t('meeting.upcomingMeetings'),\n        key: \"2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Meeting, {\n        conferences: this.state[_confType.UPCOMING],\n        conferenceType: _confType.UPCOMING,\n        handleDeleteItem: this.handleDeleteItem,\n        handleShowDetail: this.handleShowDetail,\n        handleCreateConference: this.handleCreateConference,\n        handleJoinConference: this.handleJoinConference,\n        refetch: this.queryConferences,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(TabPane, {\n        tab: i18n.t('meeting.previousMeetings'),\n        key: \"3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Meeting, {\n        conferences: filteredPrevConf,\n        conferenceType: _confType.PREVIOUS,\n        handleDeleteItem: this.handleDeleteItem,\n        handleShowDetail: this.handleShowDetail,\n        handleCreateConference: this.handleCreateConference,\n        handleJoinConference: this.handleJoinConference,\n        refetch: this.queryConferences,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 13\n        }\n      })))), _switchComponent);\n      return /*#__PURE__*/React.createElement(React.Fragment, null, breadcrumbPath.length !== 1 && /*#__PURE__*/React.createElement(_Breadcrumb, {\n        separator: \">\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 11\n        }\n      }, breadcrumbPath.map(function (e, i) {\n        return /*#__PURE__*/React.createElement(_Breadcrumb.Item, {\n          key: i,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 15\n          }\n        }, e === 'All Meetings' ? /*#__PURE__*/React.createElement(\"span\", {\n          className: \"clickableSpan\",\n          onClick: _this2.backToDefault,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 203,\n            columnNumber: 19\n          }\n        }, _this2.props.i18n.t('meeting.myMeetings')) : /*#__PURE__*/React.createElement(\"span\", {\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 21\n          }\n        }, _this2.props.i18n.t(e)));\n      })), switchComponent[display]);\n    }\n  }]);\n\n  return ConferencesComponent;\n}(Component), _temp)) || _class) || _class) || _class);\nexport default withTranslation()(ConferencesComponent);","map":{"version":3,"sources":["/home/sang/js/cfr-frontend/src/pages/dashboard/conferences/index.jsx"],"names":["React","Component","inject","observer","withTranslation","_confType","ROLE","Meeting","CreateConference","client","Q_CONFERENCES","M_DELETE_CONFERENCE","newNotification","returnError","isSupperAdmin","withRouter","TabPane","DISPLAY","DETAIL","CREATE","DEFAULT","EDIT","ConferencesComponent","stores","props","handleDeleteItem","_id","type","mutate","mutation","variables","conferenceId","then","deleteConference","data","queryConferences","backToDefault","i18n","t","catch","error","errorMessage","container","filter","query","fetchPolicy","conferences","setState","componentDidMount","PREVIOUS","ONGOING","UPCOMING","handleCreateConference","newBreadCrumbPath","state","breadcrumbPath","push","display","handleShowDetail","arg","history","conferenceToShowDetail","handleJoinConference","e","window","open","location","origin","conferenceSelected","url","URL","href","isCreateConference","searchParams","get","setTimeout","myInfo","globalState","profiles","filteredPrevConf","conf","users","map","user","includes","createdBy","some","profile","role","code","R_ADMIN","switchComponent","length","i"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { inject, observer } from 'mobx-react'\nimport { Tabs, Breadcrumb } from 'antd'\nimport { withTranslation } from 'react-i18next'\nimport { _confType, ROLE } from '@constants'\n\nimport Meeting from './Meeting'\nimport CreateConference from './CreateConference'\n\nimport { client, Q_CONFERENCES, M_DELETE_CONFERENCE } from '@graphql'\nimport { newNotification, returnError, isSupperAdmin } from '@utils'\nimport { withRouter } from 'react-router-dom'\n\nconst { TabPane } = Tabs\n\nconst DISPLAY = {\n  DETAIL: 'DETAIL',\n  CREATE: 'CREATE',\n  DEFAULT: 'DEFAULT',\n  EDIT: 'EDIT'\n}\n\n@withRouter\n@inject(({ stores }) => stores)\n@observer\nclass ConferencesComponent extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      display: DISPLAY.DEFAULT,\n      conferences: [],\n      breadcrumbPath: ['All Meetings'],\n      conferenceToShowDetail: '',\n      conferenceSelected: null,\n\n      [_confType.PREVIOUS]: [],\n      [_confType.ONGOING]: [],\n      [_confType.UPCOMING]: []\n    }\n\n    const url = new URL(window.location.href)\n    const isCreateConference = url.searchParams.get('createConference')\n    if (isCreateConference) {\n      setTimeout(() => {\n        this.handleCreateConference()\n      }, 200)\n    }\n  }\n\n  handleDeleteItem = (_id, type) => {\n    client\n      .mutate({\n        mutation: M_DELETE_CONFERENCE,\n        variables: { conferenceId: _id }\n      })\n      .then(({ data: { deleteConference } }) => {\n        if (deleteConference) {\n          this.queryConferences(type)\n          this.backToDefault()\n          return newNotification(this.props.i18n.t('notification.deleteMeetingSuccess'), 'success')\n        }\n      })\n      .catch(error =>\n        returnError(\n          'Delete Conference',\n          {\n            error,\n            errorMessage: this.props.i18n.t('notification.deleteMeetingError')\n          },\n          { container: 'top-right' }\n        )\n      )\n  }\n\n  queryConferences = (type, filter) => {\n    client\n      .query({\n        query: Q_CONFERENCES,\n        variables: { type, filter },\n        fetchPolicy: 'network-only'\n      })\n      .then(({ data: { conferences } }) => {\n        this.setState({ [type]: conferences })\n      })\n      .catch(error =>\n        returnError(\n          'Get conferences',\n          {\n            error,\n            errorMessage: this.props.i18n.t('notification.queryConferenceError')\n          },\n          { container: 'top-right' }\n        )\n      )\n  }\n\n\n  componentDidMount = () => {\n    this.queryConferences(_confType.PREVIOUS)\n    this.queryConferences(_confType.ONGOING)\n    this.queryConferences(_confType.UPCOMING)\n  }\n\n  handleCreateConference = () => {\n    let newBreadCrumbPath = this.state.breadcrumbPath\n    newBreadCrumbPath.push('meeting.createMeeting')\n\n    this.setState({\n      display: DISPLAY.CREATE,\n      breadcrumbPath: newBreadCrumbPath\n    })\n  }\n\n  handleShowDetail = arg => {\n    this.props.history.push(`/conferenceDetail/${arg}`)\n  }\n\n  backToDefault = () => {\n    this.setState({\n      display: DISPLAY.DEFAULT,\n      breadcrumbPath: ['All Meetings'],\n      conferenceToShowDetail: ''\n    })\n  }\n\n  handleJoinConference = e => {\n    window.open(`${window.location.origin}/cfr/conference/${e}`)\n  }\n\n  render() {\n    const {\n      state: { breadcrumbPath, display },\n      props: {\n        i18n,\n        globalState: { myInfo }\n      }\n    } = this\n\n    const profiles = myInfo?.profiles\n\n    //TODO: Upgrade check by Permission code\n    const filteredPrevConf = this.state[_confType.PREVIOUS].filter(\n      conf =>\n        conf.users.map(e => e.user._id).includes(myInfo._id) ||\n        conf.createdBy._id === myInfo._id ||\n        isSupperAdmin(profiles) || profiles?.some(profile => profile?.role?.code === ROLE.R_ADMIN)\n    )\n\n    const switchComponent = {\n      [DISPLAY.CREATE]: (\n        <CreateConference\n          refetch={this.queryConferences}\n          handleShowDetail={this.handleShowDetail}\n          backToDefault={this.backToDefault}\n        />\n      ),\n      [DISPLAY.DEFAULT]: (\n        <Tabs className='conferenceTabs'>\n          <TabPane tab={i18n.t('meeting.ongoingMeetings')} key='1'>\n            <Meeting\n              conferences={this.state[_confType.ONGOING]}\n              conferenceType={_confType.ONGOING}\n              handleDeleteItem={this.handleDeleteItem}\n              handleShowDetail={this.handleShowDetail}\n              handleCreateConference={this.handleCreateConference}\n              handleJoinConference={this.handleJoinConference}\n              refetch={this.queryConferences}\n            />\n          </TabPane>\n          <TabPane tab={i18n.t('meeting.upcomingMeetings')} key='2'>\n            <Meeting\n              conferences={this.state[_confType.UPCOMING]}\n              conferenceType={_confType.UPCOMING}\n              handleDeleteItem={this.handleDeleteItem}\n              handleShowDetail={this.handleShowDetail}\n              handleCreateConference={this.handleCreateConference}\n              handleJoinConference={this.handleJoinConference}\n              refetch={this.queryConferences}\n            />\n          </TabPane>\n          <TabPane tab={i18n.t('meeting.previousMeetings')} key='3'>\n            <Meeting\n              conferences={filteredPrevConf}\n              conferenceType={_confType.PREVIOUS}\n              handleDeleteItem={this.handleDeleteItem}\n              handleShowDetail={this.handleShowDetail}\n              handleCreateConference={this.handleCreateConference}\n              handleJoinConference={this.handleJoinConference}\n              refetch={this.queryConferences}\n            />\n          </TabPane>\n        </Tabs>\n      )\n    }\n\n    return (\n      <>\n        {breadcrumbPath.length !== 1 && (\n          <Breadcrumb separator='>'>\n            {breadcrumbPath.map((e, i) => (\n              <Breadcrumb.Item key={i}>\n                {e === 'All Meetings' ? (\n                  <span className='clickableSpan' onClick={this.backToDefault}>\n                    {this.props.i18n.t('meeting.myMeetings')}\n                  </span>\n                ) : (\n                    <span>{this.props.i18n.t(e)}</span>\n                  )}\n              </Breadcrumb.Item>\n            ))}\n          </Breadcrumb>\n        )}\n        {switchComponent[display]}\n      </>\n    )\n  }\n}\n\nexport default withTranslation()(ConferencesComponent)\n"]},"metadata":{},"sourceType":"module"}